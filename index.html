<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="万事起于乎微">
<meta name="keywords" content="android">
<meta property="og:type" content="website">
<meta property="og:title" content="夏霂熠雨">
<meta property="og:url" content="https://xiaxiayang.github.io/index.html">
<meta property="og:site_name" content="夏霂熠雨">
<meta property="og:description" content="万事起于乎微">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="夏霂熠雨">
<meta name="twitter:description" content="万事起于乎微">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://xiaxiayang.github.io/"/>





  <title>夏霂熠雨</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
<a href="https://github.com/xiaxiayang" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></a>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">夏霂熠雨</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xiaxiayang.github.io/2019/02/20/RecycleView 系列（3）-- 利用 ItemDecoration 实现时光轴（物流时间）样式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiaxiayang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/25956745?s=400&u=3b875396982ce81f05ad70778ceee4e3daf8d909&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夏霂熠雨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/20/RecycleView 系列（3）-- 利用 ItemDecoration 实现时光轴（物流时间）样式/" itemprop="url">RecycleView 系列（3）-- 利用 ItemDecoration 实现时光轴（物流时间）样式类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-20T19:40:34+08:00">
                2019-02-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/02/20/RecycleView 系列（3）-- 利用 ItemDecoration 实现时光轴（物流时间）样式/" class="leancloud_visitors" data-flag-title="RecycleView 系列（3）-- 利用 ItemDecoration 实现时光轴（物流时间）样式类">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>℃</span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p><a href="https://blog.csdn.net/qq_33703877/article/details/86499567" target="_blank" rel="noopener">上一篇</a>文章中详细介绍了 ItemDecoration 这个了类，了解了 RecycleView 实现分割线的原理。</p>
<p>下面我们来进入实战篇，首先实现一个比较常见的时光轴(物流详情)的效果。</p>
<h3 id="一、-效果分析"><a href="#一、-效果分析" class="headerlink" title="一、 效果分析"></a>一、 效果分析</h3><p>首先我来分析一下常见的一种物流详情效果图：<br><img src="https://i.loli.net/2019/02/20/5c6d3d302918a.jpg" alt="1.jpg"><br>分析可知，常规的 item 布局实现无法满足此需求，因为我们在 layout 中不知道 item 的高度为多少，中间那条竖线不容易实现。<br>有了上节对 ItemDecoration 的了解，我们可以将左边布局（蓝色框以左) 当做分割线来处理。</p>
<p>其中需要注意的有：</p>
<ol>
<li>红色框内表示整个 item 内容</li>
<li>蓝色框内 item 在 <strong>布局中</strong> 固定的内容</li>
<li>绿色框内小图标的绘制</li>
<li>黄色框内时间的绘制</li>
<li>灰色框内竖线的绘制</li>
</ol>
<h4 id="二、功能实现"><a href="#二、功能实现" class="headerlink" title="二、功能实现"></a>二、功能实现</h4><p>既然知道了思路，根据上节的步骤按部就班的就好。</p>
<p>1.首先模拟下数据结构，定义好 dataBean，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">public class LogisticsInfoBean  implements Serializable &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 物流信息</span><br><span class="line">     */</span><br><span class="line">    private String message;</span><br><span class="line">    /**</span><br><span class="line">     * 当前物流状态</span><br><span class="line">     */</span><br><span class="line">    private LogisticsStatus status;</span><br><span class="line">    /**</span><br><span class="line">     * 日期</span><br><span class="line">     */</span><br><span class="line">    private String date;</span><br><span class="line">    /**</span><br><span class="line">     * 时间</span><br><span class="line">     */</span><br><span class="line">    private String time;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">public enum LogisticsStatus &#123;</span><br><span class="line">    /**</span><br><span class="line">     *  一般提示语</span><br><span class="line">     */</span><br><span class="line">    TIPS,</span><br><span class="line">    /**</span><br><span class="line">     * 已下单</span><br><span class="line">     */</span><br><span class="line">    ORDERED,</span><br><span class="line">    /**</span><br><span class="line">     * 备货中</span><br><span class="line">     */</span><br><span class="line">    STOCK_UP ,</span><br><span class="line">    /**</span><br><span class="line">     * 已发货</span><br><span class="line">     */</span><br><span class="line">    DELIVERED,</span><br><span class="line">    /**</span><br><span class="line">     * 运输中</span><br><span class="line">     */</span><br><span class="line">    TRANSPORTING,</span><br><span class="line">    /**</span><br><span class="line">     * 已收货</span><br><span class="line">     */</span><br><span class="line">    RECEIVING</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.设置 <code>getItemOffsets()</code> </p>
<p>因为我们作为分割线的部分是蓝色框以左，所以我们需要设置 item 左边 left 的边距，假设预留 120 像素的边距。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 设置 item  lef他方向的偏移量</span><br><span class="line"> */</span><br><span class="line">private int leftOffset = 120;</span><br><span class="line">   </span><br><span class="line">  @Override</span><br><span class="line">public void getItemOffsets(@NonNull Rect outRect, @NonNull View view, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) &#123;</span><br><span class="line">    super.getItemOffsets(outRect, view, parent, state);</span><br><span class="line">    //设置item 左边流出 leftOffset 的边距</span><br><span class="line">    outRect.left = leftOffset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>通过 <code>onDraw()</code> 方法绘制左边分割线内的内容</li>
</ol>
<p>绘制是主要的部分，而  <code>onDraw()</code> 方法 作用于 RecycleView, 所以我们需要遍历 item ，计算绘制内容的坐标，<br>然后通过 canvas 的 draw 方法进行绘制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * 画的小圆点的半径</span><br><span class="line">   */</span><br><span class="line">  private int circleRadius = 10;</span><br><span class="line">  /**</span><br><span class="line">   * 画的小图标的宽度</span><br><span class="line">   */</span><br><span class="line">  private int iconWidth = 50;</span><br><span class="line">  private Context context;</span><br><span class="line">  private int padding  = 24;</span><br><span class="line">  @Override</span><br><span class="line">  public void onDraw(@NonNull Canvas canvas, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) &#123;</span><br><span class="line">      Log.d(TAG,&quot;----onDraw---&quot;);</span><br><span class="line">      canvas.save();</span><br><span class="line">      //先画分割线整体背景色</span><br><span class="line">      canvas.drawColor(context.getResources().getColor(R.color.white));</span><br><span class="line">      final int childCount = parent.getChildCount();</span><br><span class="line">      //遍历 </span><br><span class="line">      for (int i = 0; i &lt; childCount; i++) &#123;</span><br><span class="line">          final View child = parent.getChildAt(i);</span><br><span class="line">          //1.先画 1 px 的图标上半部分的竖线</span><br><span class="line">          int startX = leftOffset-30;</span><br><span class="line">          int startY = child.getTop();</span><br><span class="line">          int lineStopY = startY+padding;</span><br><span class="line">          paint.setColor(context.getResources().getColor(R.color.gray_deep));</span><br><span class="line">          canvas.drawLine(startX,startY,startX,lineStopY,paint);</span><br><span class="line">          //2.画图形</span><br><span class="line">          int positon = parent.getChildAdapterPosition(child);</span><br><span class="line">          LogisticsInfoBean bean = dataBeanList.get(positon);</span><br><span class="line">          Rect dst = new Rect(startX-iconWidth/2,lineStopY,startX+iconWidth/2,lineStopY+iconWidth);</span><br><span class="line">          //根据不同状态画不同图形</span><br><span class="line">          switch (bean.getStatus())&#123;</span><br><span class="line">              case TIPS:</span><br><span class="line">                  canvas.drawCircle(startX,lineStopY+circleRadius,circleRadius,paint);</span><br><span class="line">                  break;</span><br><span class="line">              case ORDERED:</span><br><span class="line">                  canvas.drawBitmap(BitmapFactory.decodeResource(context.getResources(),R.drawable.ic_order),null,dst,null);</span><br><span class="line">                  break;</span><br><span class="line">              case STOCK_UP:</span><br><span class="line">                  canvas.drawBitmap(BitmapFactory.decodeResource(context.getResources(),R.drawable.ic_stockup),null,dst,null);</span><br><span class="line">                  break;</span><br><span class="line">              case DELIVERED:</span><br><span class="line">                  canvas.drawBitmap(BitmapFactory.decodeResource(context.getResources(),R.drawable.ic_diliver),null,dst,null);</span><br><span class="line">                  break;</span><br><span class="line">              case TRANSPORTING:</span><br><span class="line">                  canvas.drawBitmap(BitmapFactory.decodeResource(context.getResources(),R.drawable.ic_transporting),null,dst,null);</span><br><span class="line">                  break;</span><br><span class="line">              case RECEIVING:</span><br><span class="line">                  canvas.drawBitmap(BitmapFactory.decodeResource(context.getResources(),R.drawable.ic_receive),null,dst,null);</span><br><span class="line">                  break;</span><br><span class="line">              default:</span><br><span class="line">                  canvas.drawCircle(startX,lineStopY+circleRadius,circleRadius,paint);</span><br><span class="line">                  break;</span><br><span class="line">          &#125;</span><br><span class="line">          //画下半部分竖线</span><br><span class="line">          if (positon != dataBeanList.size() -1)&#123;</span><br><span class="line">              if (bean.getStatus() == LogisticsStatus.TIPS)&#123;</span><br><span class="line">                  canvas.drawLine(startX,lineStopY+2*circleRadius,startX,child.getBottom(),paint);</span><br><span class="line">              &#125;else &#123;</span><br><span class="line">                  canvas.drawLine(startX,lineStopY+iconWidth,startX,child.getBottom(),paint);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          //3.画日期</span><br><span class="line">          canvas.drawText(bean.getDate(),startX-iconWidth/2-10,lineStopY+iconWidth/2,paint);</span><br><span class="line">          canvas.drawText(bean.getTime(),startX-iconWidth/2-10,lineStopY+iconWidth/2+20,paint);</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      canvas.restore();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>4.设置数据源</p>
<p>让我们来造点假数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">   protected void initData() &#123;</span><br><span class="line">       dataBeanList.add(new LogisticsInfoBean(&quot;[收货地址，xxxxxxx]&quot;,LogisticsStatus.RECEIVING,&quot;02-11&quot;,&quot;10:00&quot;));</span><br><span class="line">       dataBeanList.add(new LogisticsInfoBean(&quot;小主，运输中x1&quot;,LogisticsStatus.TRANSPORTING,&quot;02-10&quot;,&quot;12:00&quot;));</span><br><span class="line">       dataBeanList.add(new LogisticsInfoBean(&quot;小主，\n运输中x2&quot;,LogisticsStatus.TRANSPORTING,&quot;02-10&quot;,&quot;12:10&quot;));</span><br><span class="line">       dataBeanList.add(new LogisticsInfoBean(&quot;小主，\n\n运输中x3&quot;,LogisticsStatus.TRANSPORTING,&quot;02-10&quot;,&quot;12:20&quot;));</span><br><span class="line">       dataBeanList.add(new LogisticsInfoBean(&quot;小主，\n运输中x4&quot;,LogisticsStatus.TRANSPORTING,&quot;02-10&quot;,&quot;12:30&quot;));</span><br><span class="line">       dataBeanList.add(new LogisticsInfoBean(&quot;小主，已发货&quot;,LogisticsStatus.DELIVERED,&quot;02-10&quot;,&quot;10:00&quot;));</span><br><span class="line">       dataBeanList.add(new LogisticsInfoBean(&quot;小主，备货中&quot;,LogisticsStatus.STOCK_UP,&quot;02-09&quot;,&quot;12:00&quot;));</span><br><span class="line">       dataBeanList.add(new LogisticsInfoBean(&quot;订单支付成功，系统正在处理&quot;,LogisticsStatus.ORDERED,&quot;02-09&quot;,&quot;10:10&quot;));</span><br><span class="line">       dataBeanList.add(new LogisticsInfoBean(&quot;订单创建成功，等待支付&quot;,LogisticsStatus.TIPS,&quot;02-09&quot;,&quot;10:00&quot;));</span><br><span class="line"></span><br><span class="line">       adapter.notifyDataSetChanged();</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>其他一些设置这里就不在说了，然后运行看一下效果：<br><img src="https://i.loli.net/2019/02/20/5c6d3d300cb1a.jpg" alt="2.jpg"><br>所以，实现起来也很简单有没有。</p>
<p>完整代码看这里：<a href="https://github.com/xiaxiayang/AdvancedPractice" target="_blank" rel="noopener">demo 传送门</a></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>关于分割线的实现，不管是什么样式的，按照之前说的步骤一步步来就好：</p>
<ul>
<li>通过 <code>getItemOffset（）</code> 方法设置 item 的偏移量**</li>
<li>在 <code>onDraw（）</code>或 <code>onDrawOver（）</code> 方法中完成绘制**</li>
<li>遍历 item，计算分割线的位置**</li>
<li>通过 <code>draw（）</code>方法完成绘制**</li>
</ul>
<p>其中需要注意的是各个绘制内容坐标的计算。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://blog.csdn.net/carson_ho/article/details/75005994" target="_blank" rel="noopener">Android 自定义View实战系列 ：时间轴</a><br><a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.ItemDecoration" target="_blank" rel="noopener">https://developer.android.com/reference/android/support/v7/widget/RecyclerView.ItemDecoration</a></p>

          
        
      
    </div>
    
    
    
<div>
  
</div>
<div>
      
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xiaxiayang.github.io/2019/02/10/RecycleView 系列（2）-- 认识 ItemDecoration 类/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiaxiayang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/25956745?s=400&u=3b875396982ce81f05ad70778ceee4e3daf8d909&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夏霂熠雨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/RecycleView 系列（2）-- 认识 ItemDecoration 类/" itemprop="url">RecycleView 系列（2）-- 认识 ItemDecoration 类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T09:54:34+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/02/10/RecycleView 系列（2）-- 认识 ItemDecoration 类/" class="leancloud_visitors" data-flag-title="RecycleView 系列（2）-- 认识 ItemDecoration 类">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>℃</span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p><a href="https://blog.csdn.net/qq_33703877/article/details/86379020" target="_blank" rel="noopener">上一篇</a> 博客介绍了 RecycleView 的基本使用，接下来我们来给列表添加点装饰 - <strong>分割线</strong>。</p>
<p>RecycleView 没有像 ListView 一样可以直接在 xml 中或者通过 <code>setDivider（）</code>方法设置分割线的方法。它是通过 RecycleView 的 <code>addItemDecoration(ItemDecoration decor)</code> 方法来设置的。很显然，我们需要传入一个 ItemDecoration  对象，这个对象是一个抽象类，官方已经提供了一种常用分割线类：DividerItemDecoration。来看一下用法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 这里 LayoutManager 为 LinearLayoutManager</span><br><span class="line">DividerItemDecoration itemDecoration = new DividerItemDecoration(this,DividerItemDecoration.VERTICAL);</span><br><span class="line">recycleView.addItemDecoration(itemDecoration )</span><br></pre></td></tr></table></figure>
<p>也很简单有木有，运行代码看下效果：<br><img src="https://i.loli.net/2019/02/10/5c5f84e023982.png" alt="1.png"><br>那这个简单的效果是如何实现的呢？前面说过 RecycleView 的分割线是由 <code>RecyclerView.ItemDecoration</code> 这个类来实现的，所以我们要先来了解一下这个类。</p>
<h4 id="一-ItemDecoration-类介绍"><a href="#一-ItemDecoration-类介绍" class="headerlink" title="一.ItemDecoration 类介绍"></a>一.ItemDecoration 类介绍</h4><p>惯例先看一下<a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.ItemDecoration" target="_blank" rel="noopener">文档</a>中对 ItemDecoration  类的介绍：</p>
<blockquote>
<p>An ItemDecoration allows the application to add a special drawing and layout offset to specific item views from the adapter’s data set. This can be useful for drawing dividers between items, highlights, visual grouping boundaries and more.<br>All ItemDecorations are drawn in the order they were added, before the item views (in onDraw() and after the items (in onDrawOver(Canvas, RecyclerView, RecyclerView.State).<br>ItemDecoration 允许应用程序为特定的 item 视图添加一个特殊的<strong>绘图</strong>和<strong>布局偏移量</strong>。这对于绘制 items 之间的分隔线、高亮显示、可视分组等非常有用。<br>所有的 item 的装饰都是按照被添加的顺序绘制的，先于 item 的绘制(在<code>onDraw()</code> 方法中)，和在 item 绘制后 (<code>onDrawOver(Canvas, RecyclerView, RecyclerView.State)</code>方法中)。</p>
</blockquote>
<p>从这段介绍中，我们可以得到以下信息：</p>
<ul>
<li>ItemDecoration  可以为 item 添加绘图，还可以设置偏移量</li>
<li>ItemDecoration  可以用于实现 item 之间的分隔线、高亮显示、可视分组等功能</li>
<li>ItemDecoration 中的 <code>onDraw()</code> 方法先于 item 绘制，<code>onDrawOver(Canvas, RecyclerView, RecyclerView.State</code>方法执行顺序在 item 的绘制之后</li>
</ul>
<p>让我们来新建一个类，继承 RecyclerView.ItemDecoration，默认会要实现它的三个抽象方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class BasicDivider extends RecyclerView.ItemDecoration &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onDraw(@NonNull Canvas canvas, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void onDrawOver(@NonNull Canvas canvas, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void getItemOffsets(@NonNull Rect outRect, @NonNull View view, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) &#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>看一下文档中对这三个方法的说明：</p>
<p> <strong>1.getItemOffsets () 方法：</strong></p>
<ul>
<li>重新得到给定 item 的任何偏移量。outRect 的每个字段指定 item 视图应该插入多少像素，效果类似于 padding 或 margin。默认将 outRect 的边界设置为 0 并返回；</li>
<li>.如果这个 ItemDecoration 不影响 item 视图的位置，在 return 之前要先将 outRect的所有四个字段 (left, top, right, bottom) 设为 0；</li>
<li>如果您需要访问适配器以获取额外的数据，您可以调用 <code>getChildAdapterPosition(View)</code> 来获取该 View 在适配器中位置；</li>
</ul>
<p>这个方法中比较关键的就是第一点的理解，<strong>设置 outRect 的值，效果类似给 item 设置了 padding 或者 margin</strong>。我们可以看一下下图理解一下：<br><img src="https://i.loli.net/2019/02/10/5c5f84e014fdc.png" alt="2.png"><br>到这其实我们已经可以看到，RecycleView 是通过这个 rectRect 的值来给 item 设置“空隙”，然后达到分割线的效果。</p>
<p>为了更好的理解这个方法，我们在代码中动态设置 outRect 的四个值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public class BasicDivider extends RecyclerView.ItemDecoration &#123;</span><br><span class="line"></span><br><span class="line">    private static final String TAG = &quot;DividerItem&quot;;</span><br><span class="line">    /**</span><br><span class="line">     * 获取 item 在四个方向上的偏移量</span><br><span class="line">     */</span><br><span class="line">    private int leftOffset;</span><br><span class="line">    private int topOffset;</span><br><span class="line">    private int rightOffset;</span><br><span class="line">    private int bottomOffset;</span><br><span class="line">    private Context context;</span><br><span class="line">    </span><br><span class="line">    public BasicDivider(Context context) &#123;</span><br><span class="line">        this(context,0,0,0,0);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public BasicDivider(Context context, int left, int top, int right, int bottom) &#123;</span><br><span class="line">        this.leftOffset = left;</span><br><span class="line">        this.topOffset = top;</span><br><span class="line">        this.rightOffset = right;</span><br><span class="line">        this.bottomOffset = bottom;</span><br><span class="line">        this.context = context;</span><br><span class="line">    &#125;</span><br><span class="line">    public void onDraw(@NonNull Canvas canvas, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    @Override</span><br><span class="line">    public void onDrawOver(@NonNull Canvas canvas, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void getItemOffsets(@NonNull Rect outRect, @NonNull View view, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) &#123;</span><br><span class="line">        super.getItemOffsets(outRect, view, parent, state);</span><br><span class="line">        outRect.set(leftOffset,topOffset,rightOffset,rightOffset);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>其中的 leftOffset、topOffset、rightOffset、rightOffset 由外部设置得到，这里代码省略，然后看下效果：</p>
<p>需要注意的是通过 <code>getItemOffsets</code> 方法设置分割线，分割线的颜色是 RecycleView 的 backgroundColor 的颜色。所以我们如果想修改分割线的颜色，就必须修改 recycleView 的背景色。</p>
<p>那么假设我想要一个渐变色的分割线或者其他样式的分割线怎么办呢？<br>答案就是剩下的两个方法 <code>ondraw（）</code>和 <code>onDrawOver（）</code>方法 可以上场了。</p>
<p> <strong>2.onDraw () 方法：</strong></p>
<blockquote>
<p>Draw any appropriate decorations into the Canvas supplied to the RecyclerView. Any content drawn by this method will be drawn before the item views are drawn, and will thus appear underneath the views<br>在 RecycleView 的画布中绘制任意合适的装饰。通过该方法绘制的内容将在 item 的绘制之前被绘制，因此会在 item 的下方显示</p>
</blockquote>
<p>通过这个介绍我们可以知道以下三点：</p>
<ul>
<li><strong>onDraw（） 方法的使用对象是整个 RecycleView，而不是针对单个的 item</strong></li>
<li><strong>onDraw（）方法可以绘制任何装饰（ 通过canvas可以随心所欲）</strong></li>
<li><strong>这个方法在 item 之前被绘制，因此位置计算不当，可能会出现被 item 遮挡的情况</strong></li>
</ul>
<p>那我们来想一下，如何实现在 RecycleView 背景为灰色，但分割线为 “10 px 的红色” 的功能。这里我写下我分析的步骤：</p>
<p><strong>(1).通过 getItemOffsets（）方法设置 item 的间距，预留分割线的宽度</strong><br> <strong>(2).通过 onDraw（）方法绘制分割线，具体又细分为：</strong></p>
<ul>
<li><strong>计算绘制的位置</strong>。因为canvas 是这个 RecycleView 的，所以我们要计算每条线的位置</li>
<li><strong>绘制</strong>。使用 <code>canvas.drawRect（</code>）或者 <code>canvas.drawLine（）</code> 方法进行绘制</li>
</ul>
<p>看一下主要代码实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 在提供给 RecycleView 的画布中绘制适当的装饰。</span><br><span class="line">    @Override</span><br><span class="line">    public void onDraw(@NonNull Canvas canvas, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) &#123;</span><br><span class="line">        Log.d(TAG,&quot;----onDraw---&quot;);</span><br><span class="line">        canvas.save();</span><br><span class="line">        final int left;</span><br><span class="line">        final int right;</span><br><span class="line">        left = 0;</span><br><span class="line">        right = parent.getRight();</span><br><span class="line">        final int childCount = parent.getChildCount();</span><br><span class="line">         bottomOffset = 10;</span><br><span class="line">        // 遍历 item，获取每个item 的位置从而定位要绘制的分割线的位置</span><br><span class="line">        for (int i = 0; i &lt; childCount; i++) &#123;</span><br><span class="line">            final View child = parent.getChildAt(i);</span><br><span class="line">            //计算分割线的位置</span><br><span class="line">            final int bottom = child.getBottom()+bottomOffset;</span><br><span class="line">            final int top = child.getBottom();</span><br><span class="line">            canvas.drawRect(left,top,right,bottom,paint);</span><br><span class="line">        &#125;</span><br><span class="line">        canvas.restore();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> //.重新得到给定 item 的任何偏移量</span><br><span class="line">    @Override</span><br><span class="line">    public void getItemOffsets(@NonNull Rect outRect, @NonNull View view, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) &#123;</span><br><span class="line">        super.getItemOffsets(outRect, view, parent, state);</span><br><span class="line">        //设置 item 底部偏移 10 dp</span><br><span class="line">        outRect.bottom = 10;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>关于分割线位置的计算，我们可以借助一下图，就会很容易计算：<br><img src="https://i.loli.net/2019/02/10/5c5f84dfe7050.png" alt="3.png"><br>只要计算 A点和 D 点的坐标即可。当然，我这里写的是最简单的情况，不考虑 RecycleView 及 item 的 padding 和 margin，其实计算的时候也是应该考虑进去的。<br>然后我们运行看一下效果：<br><img src="https://i.loli.net/2019/02/10/5c5f84e0153f8.png" alt="4.png"><br>然后来验证一下，<code>onDraw（）</code>方法是在 item 之前绘制的，把上述 <code>onDraw（）</code>方法中的 <code>bottomOffset = 50</code>，也就是绘制的区域其实是 item 下方 50 px 高度的矩形。</p>
<p>然后运行，发现效果和上一张图一样。也就是说我们绘制的内容被 item 给覆盖住了。</p>
<p>所以，如果想让内容绘制在 item 之上，不被盖住，我们需要了解下面的方法。</p>
<p> <strong>3.onDrawOver () 方法：</strong><br> 与 <code>onDraw()</code> 方法作用一样，但是是在 item 之后绘制，所以不会被遮挡覆盖。</p>
<p> 我们把例子中 <code>onDraw（）</code>方法中的代码移到 <code>onDrawOver ()</code> 方法中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public void onDrawOver(@NonNull Canvas canvas, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) &#123;</span><br><span class="line">       Log.d(TAG,&quot;----onDrawOver---&quot;);</span><br><span class="line">       canvas.save();</span><br><span class="line">       final int left;</span><br><span class="line">       final int right;</span><br><span class="line">       left = 0;</span><br><span class="line">       right = parent.getRight();</span><br><span class="line">       bottomOffset = 50;</span><br><span class="line">       final int childCount = parent.getChildCount();</span><br><span class="line">       for (int i = 0; i &lt; childCount; i++) &#123;</span><br><span class="line">           final View child = parent.getChildAt(i);</span><br><span class="line">           final int bottom = child.getBottom()+bottomOffset;</span><br><span class="line">           final int top = child.getBottom();</span><br><span class="line">           canvas.drawRect(left,top,right,bottom,paint);</span><br><span class="line">       &#125;</span><br><span class="line">       canvas.restore();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>然后看一下效果:<br><img src="https://i.loli.net/2019/02/10/5c5f84e016a7a.png" alt="5.png"><br>可以看到，方法中绘制的内容会覆盖在 item 之上。也就验证了 <code>onDrawOver ()</code> 方法在 item 之后绘制。</p>
<h4 id="二-解析默认分割线的实现"><a href="#二-解析默认分割线的实现" class="headerlink" title="二.解析默认分割线的实现"></a>二.解析默认分割线的实现</h4><p>了解了 <code>ItemDecoration</code> 各个方法的作用，下面我们来分析一下默认提供的分割线的内部实现，</p>
<p>先看一下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">public class DividerItemDecoration extends RecyclerView.ItemDecoration &#123;</span><br><span class="line">    public static final int HORIZONTAL = LinearLayout.HORIZONTAL;</span><br><span class="line">    public static final int VERTICAL = LinearLayout.VERTICAL;</span><br><span class="line"></span><br><span class="line">    private static final String TAG = &quot;DividerItem&quot;;</span><br><span class="line">    private static final int[] ATTRS = new int[]&#123; android.R.attr.listDivider &#125;;</span><br><span class="line"></span><br><span class="line">    private Drawable mDivider;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Current orientation. Either &#123;@link #HORIZONTAL&#125; or &#123;@link #VERTICAL&#125;.</span><br><span class="line">     */</span><br><span class="line">    private int mOrientation;</span><br><span class="line"></span><br><span class="line">    private final Rect mBounds = new Rect();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Creates a divider &#123;@link RecyclerView.ItemDecoration&#125; that can be used with a</span><br><span class="line">     * &#123;@link LinearLayoutManager&#125;.</span><br><span class="line">     *</span><br><span class="line">     * @param context Current context, it will be used to access resources.</span><br><span class="line">     * @param orientation Divider orientation. Should be &#123;@link #HORIZONTAL&#125; or &#123;@link #VERTICAL&#125;.</span><br><span class="line">     */</span><br><span class="line">    public DividerItemDecoration(Context context, int orientation) &#123;</span><br><span class="line">        final TypedArray a = context.obtainStyledAttributes(ATTRS);</span><br><span class="line">        mDivider = a.getDrawable(0);</span><br><span class="line">        if (mDivider == null) &#123;</span><br><span class="line">            Log.w(TAG, &quot;@android:attr/listDivider was not set in the theme used for this &quot;</span><br><span class="line">                    + &quot;DividerItemDecoration. Please set that attribute all call setDrawable()&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        a.recycle();</span><br><span class="line">        setOrientation(orientation);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Sets the orientation for this divider. This should be called if</span><br><span class="line">     * &#123;@link RecyclerView.LayoutManager&#125; changes orientation.</span><br><span class="line">     *</span><br><span class="line">     * @param orientation &#123;@link #HORIZONTAL&#125; or &#123;@link #VERTICAL&#125;</span><br><span class="line">     */</span><br><span class="line">    public void setOrientation(int orientation) &#123;</span><br><span class="line">        if (orientation != HORIZONTAL &amp;&amp; orientation != VERTICAL) &#123;</span><br><span class="line">            throw new IllegalArgumentException(</span><br><span class="line">                    &quot;Invalid orientation. It should be either HORIZONTAL or VERTICAL&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        mOrientation = orientation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Sets the &#123;@link Drawable&#125; for this divider.</span><br><span class="line">     *</span><br><span class="line">     * @param drawable Drawable that should be used as a divider.</span><br><span class="line">     */</span><br><span class="line">    public void setDrawable(@NonNull Drawable drawable) &#123;</span><br><span class="line">        if (drawable == null) &#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;Drawable cannot be null.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        mDivider = drawable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onDraw(Canvas c, RecyclerView parent, RecyclerView.State state) &#123;</span><br><span class="line">        if (parent.getLayoutManager() == null || mDivider == null) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        if (mOrientation == VERTICAL) &#123;</span><br><span class="line">            drawVertical(c, parent);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            drawHorizontal(c, parent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void drawVertical(Canvas canvas, RecyclerView parent) &#123;</span><br><span class="line">        canvas.save();</span><br><span class="line">        final int left;</span><br><span class="line">        final int right;</span><br><span class="line">        //noinspection AndroidLintNewApi - NewApi lint fails to handle overrides.</span><br><span class="line">        if (parent.getClipToPadding()) &#123;</span><br><span class="line">            left = parent.getPaddingLeft();</span><br><span class="line">            right = parent.getWidth() - parent.getPaddingRight();</span><br><span class="line">            canvas.clipRect(left, parent.getPaddingTop(), right,</span><br><span class="line">                    parent.getHeight() - parent.getPaddingBottom());</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            left = 0;</span><br><span class="line">            right = parent.getWidth();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        final int childCount = parent.getChildCount();</span><br><span class="line">        for (int i = 0; i &lt; childCount; i++) &#123;</span><br><span class="line">            final View child = parent.getChildAt(i);</span><br><span class="line">            parent.getDecoratedBoundsWithMargins(child, mBounds);</span><br><span class="line">            final int bottom = mBounds.bottom + Math.round(child.getTranslationY());</span><br><span class="line">            final int top = bottom - mDivider.getIntrinsicHeight();</span><br><span class="line">            mDivider.setBounds(left, top, right, bottom);</span><br><span class="line">            mDivider.draw(canvas);</span><br><span class="line">        &#125;</span><br><span class="line">        canvas.restore();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void drawHorizontal(Canvas canvas, RecyclerView parent) &#123;</span><br><span class="line">        canvas.save();</span><br><span class="line">        final int top;</span><br><span class="line">        final int bottom;</span><br><span class="line">        //noinspection AndroidLintNewApi - NewApi lint fails to handle overrides.</span><br><span class="line">        if (parent.getClipToPadding()) &#123;</span><br><span class="line">            top = parent.getPaddingTop();</span><br><span class="line">            bottom = parent.getHeight() - parent.getPaddingBottom();</span><br><span class="line">            canvas.clipRect(parent.getPaddingLeft(), top,</span><br><span class="line">                    parent.getWidth() - parent.getPaddingRight(), bottom);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            top = 0;</span><br><span class="line">            bottom = parent.getHeight();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        final int childCount = parent.getChildCount();</span><br><span class="line">        for (int i = 0; i &lt; childCount; i++) &#123;</span><br><span class="line">            final View child = parent.getChildAt(i);</span><br><span class="line">            parent.getLayoutManager().getDecoratedBoundsWithMargins(child, mBounds);</span><br><span class="line">            final int right = mBounds.right + Math.round(child.getTranslationX());</span><br><span class="line">            final int left = right - mDivider.getIntrinsicWidth();</span><br><span class="line">            mDivider.setBounds(left, top, right, bottom);</span><br><span class="line">            mDivider.draw(canvas);</span><br><span class="line">        &#125;</span><br><span class="line">        canvas.restore();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void getItemOffsets(Rect outRect, View view, RecyclerView parent,</span><br><span class="line">            RecyclerView.State state) &#123;</span><br><span class="line">        if (mDivider == null) &#123;</span><br><span class="line">            outRect.set(0, 0, 0, 0);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        if (mOrientation == VERTICAL) &#123;</span><br><span class="line">            outRect.set(0, 0, 0, mDivider.getIntrinsicHeight());</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            outRect.set(0, 0, mDivider.getIntrinsicWidth(), 0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1.首先来分析一下 <code>getItemOffsets（）</code> 方法：</p>
<ul>
<li>mDivider 在构造函数中初始化值，为默认的分割线的 drawable 属性值</li>
<li>判断 LayoutManger 的方向，如果是 Vertical，就设置 item 的 bottom 偏移默认分割线的高度，如果是 Horizontal 就设置 item 的 right 偏移默认分割线的宽度</li>
</ul>
<p>2，分析一下 <code>onDraw（）</code> 方法<br> 首先进行 LayoutManger 方向的判断，不同的方向，分割线位置计算不同，我们这里就拿最常用的 Vertical 时的状态来看，所以具体看一下 <code>drawVertical（）</code>方法：</p>
<ul>
<li>首先通过 <code>parent.getClipToPadding()</code> 判断 RecycleView  是否设置这个参数为 true （默认值），如果为 true，那 RecycleView 显示位置区域就不会包含 padding 值的位置，所以需要进行裁剪，否则，显示 padding 区域，也就是 RecycleView 控件本身占的区域</li>
<li>遍历 item </li>
<li>获取 item 的 坐标位置，包含 item 的 insets 设置的偏移值（比如通过 getItemOffsets 设置的）和 margin 值。</li>
<li>计算绘制区域的位置信息</li>
</ul>
<p>可以看到，官方代码是先得到一个 drawable 对象，然后计算出 item 所以的偏移值，包括我们通过 <code>getItemOffsets</code> 设置的分割线的值，先计算出 bottom，然后根据 bottom 计算 top。最后通过 <code>onDraw()</code> 设置 drawable  的位置来达到分割线的效果。<br> 无疑这种考虑的更全面，我的 demo 是默认 RecycleView 和 item 都没有偏移量的情况。 </p>
<p>所以，可以看到，绘制分割线，分割线位置的计算是比较重要的，需要具体情况具体分析。</p>
<h4 id="三-利用-shape-设置分割线"><a href="#三-利用-shape-设置分割线" class="headerlink" title="三. 利用 shape 设置分割线"></a>三. 利用 shape 设置分割线</h4><p>不知道大家有没有注意到刚刚看的默认分割线的类中，暴露了这样一个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public void setDrawable(@NonNull Drawable drawable) &#123;</span><br><span class="line">       if (drawable == null) &#123;</span><br><span class="line">           throw new IllegalArgumentException(&quot;Drawable cannot be null.&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">       mDivider = drawable;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>既然是通过 <code>mDivider.draw(canvas);</code> 最后来绘制分割线的，那么只要我们修改了 drawable  对象，分割线的样式也会修改。</p>
<p>所以，对于简单的分割线，我们可以在 <code>shape</code> 文件中设置一个分割线的样式，然后通过默认分割线的 <code>setDrawable（）</code>方法设置。</p>
<p>示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> DividerItemDecoration itemDecoration = new DividerItemDecoration(this,DividerItemDecoration.VERTICAL);</span><br><span class="line">        itemDecoration.setDrawable(getResources().getDrawable(R.drawable.shape_divider));</span><br><span class="line">         rvCommon.addItemDecoration(itemDecoration );</span><br><span class="line">         </span><br><span class="line">shape:</span><br><span class="line">&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:shape=&quot;rectangle&quot;&gt;</span><br><span class="line">    &lt;solid android:color=&quot;#000&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">    &lt;size android:height=&quot;@dimen/space_10&quot;/&gt;</span><br><span class="line">    &lt;stroke android:color=&quot;@color/colorPrimaryDark&quot;</span><br><span class="line">        android:width=&quot;@dimen/space_2&quot;/&gt;</span><br><span class="line">&lt;/shape&gt;</span><br></pre></td></tr></table></figure>
<p>效果：<br><img src="https://i.loli.net/2019/02/10/5c5f84e02faf8.png" alt="6.png"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>其实分割线的实现很简单，主要掌握 <code>ItemDecoration</code> 内容就好。大致步骤有三点：</p>
<p> <strong>1. 通过 <code>getItemOffset（）</code> 方法设置 item 的偏移量</strong><br> <strong>2. 在 <code>onDraw（）</code>或 <code>onDrawOver（）</code> 方法中完成绘制</strong><br>  <strong>2.1 遍历 item，计算分割线的位置</strong><br>  <strong>2.2 通过 <code>draw（）</code>方法完成绘制</strong></p>
<p>其中需要注意的点有：</p>
<ul>
<li><code>getItemOffset（）</code>方法<strong>作用于 item</strong></li>
<li><code>onDraw（）</code>或 <code>onDrawOver（）</code>  方法<strong>作用于 RecycleView</strong> </li>
<li><code>onDraw（）</code><strong>先于</strong> item 绘制</li>
<li><code>onDrawOver（）</code> <strong>后于</strong> item 绘制</li>
<li>计算分割线位置时需考虑 RecycleView 和 item 自身<strong>偏移量</strong>的问题</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.ItemDecoration" target="_blank" rel="noopener">https://developer.android.com/reference/android/support/v7/widget/RecyclerView.ItemDecoration</a></p>

          
        
      
    </div>
    
    
    
<div>
  
</div>
<div>
      
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xiaxiayang.github.io/2019/01/13/RecycleView 系列（1）之 基本使用-数据展示/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiaxiayang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/25956745?s=400&u=3b875396982ce81f05ad70778ceee4e3daf8d909&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夏霂熠雨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/13/RecycleView 系列（1）之 基本使用-数据展示/" itemprop="url">RecycleView 系列（1）之 基本使用-数据展示</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-13T21:18:21+08:00">
                2019-01-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/01/13/RecycleView 系列（1）之 基本使用-数据展示/" class="leancloud_visitors" data-flag-title="RecycleView 系列（1）之 基本使用-数据展示">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>℃</span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>RecycleView 这个控件出来的时间已经很久了。然而我项目中开始从 ListView 彻底转型 RecycleView 也是从刚刚过去的18 年的时候才开始。不管是因为时间的原因也好，还是因为本身不太接受新的东西也好，我之前做项目的时候能用 ListView 就用 ListView，毕竟熟悉的知识会让自己有安全感。但是就像当初不太接受 android studio 而用 eclipse 一样，时间和实践都会让我们做出正确的选择。</p>
<p>因为项目中都只是用了 RecycleView 最基本的知识，而在 19 年，我想更了解它。所以开始了第一个 flag 的攻克。虽然网上已经有很多很棒的 RecycleView 系列文章，但我还是希望自己亲自一步一个脚印地去探索。通过一个个列子来慢慢了解 RecycleView 中的各个方法，努力做到知其然知其所以然。</p>
<h3 id="一-认识-RecycleView"><a href="#一-认识-RecycleView" class="headerlink" title="一.认识 RecycleView"></a>一.认识 RecycleView</h3><p>RecycleView 是在 api 版本 22 中引入的。官方文档中是这样介绍它的：</p>
<blockquote>
<p>A flexible view for providing a limited window into a large data set.<br>用有限的窗口展示大量数据集的一个灵活的控件。</p>
</blockquote>
<p>而我们看一下之前一直用的 ListView 的 介绍：</p>
<blockquote>
<p>Displays a vertically-scrollable collection of views, where each view is positioned immediatelybelow the previous view in the list. For a more modern, flexible, and performant approach to displaying lists, use RecyclerView.<br>显示可垂直滚动的视图集合，其中每个视图立即位于列表中前一个视图的下方。想展示一个更现代、更灵活和性能更好的列表的话，请使用 RecycleView。</p>
</blockquote>
<p>所以，从这两个介绍来看，我们知道 RecycleView 比 ListView 更灵活、性能更好。其实我们可以先来对比一下两者的继承关系：<br><img src="https://i.loli.net/2019/01/13/5c3b3ae28e331.png" alt="1.png"><br>可以看到 RecycleView 是直接继承自 ViewGroup的，比 ListView 直接少了两级的继承关系（嗯，如果按辈分的话，好像是爷爷辈，哈哈），是不是也可以看得出 RecycleView 比 ListView 更灵活?</p>
<p>好了，来看看如何使用吧。</p>
<h3 id="二-使用"><a href="#二-使用" class="headerlink" title="二.使用"></a>二.使用</h3><p><strong>1.在 module 的 <code>build.gradle</code> 中引入依赖:</strong></p>
<blockquote>
<p>implementation ‘com.android.support:recyclerview-v7:27.0.0’</p>
</blockquote>
<p>这个版本号可以根据自己的 sdk 的版本来。也可以通过<a href="https://developer.android.google.cn/topic/libraries/support-library/revisions" target="_blank" rel="noopener">这里</a>看看都有哪些版本。</p>
<p><strong>2.布局文件中引入</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;android.support.v7.widget.RecyclerView</span><br><span class="line">        android:id=&quot;@+id/rv_home&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line">&lt;/android.support.v7.widget.RecyclerView&gt;</span><br></pre></td></tr></table></figure>
<p><strong>3.创建 Adapter</strong></p>
<p>就像使用 ListView 一样，我们需要为 RecycleView 创建一个 Adapter，这个大家估计现在已经很熟了。</p>
<p>所以我们新建一个类，继承 RecyclerView.Adapter，同时创建 ViewHolder，实现三个默认的抽象方法，三个方法及含义如下：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>ViewHolder onCreateViewHolder(ViewGroup parent, int viewType)</td>
<td>实例化一个 ViewHolder，并初始化一些 RecycleView 使用的私有字段</td>
</tr>
<tr>
<td>void bindViewHolder (VH holder,int position)</td>
<td>更新 RecycleView 指定位置的 item 的内容，并初始化一些 RecycleView 使用的私有字段</td>
</tr>
<tr>
<td>int getItemCount()</td>
<td>返回适配器所持有的数据集中 items 的总数</td>
</tr>
</tbody>
</table>
<p>代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">public class CommonRvAdapter extends RecyclerView.Adapter&lt;CommonRvAdapter.ViewHolder&gt; &#123;</span><br><span class="line">    private final Context context;</span><br><span class="line">    private List&lt;CommonDataBean&gt; items;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 构造函数</span><br><span class="line">     * @param items</span><br><span class="line">     * @param context</span><br><span class="line">     */</span><br><span class="line">    public CommonRvAdapter(List&lt;CommonDataBean&gt; items, Context context) &#123;</span><br><span class="line">        this.items = items;</span><br><span class="line">        this.context = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 实例化 ViewHolder</span><br><span class="line">     * @param parent</span><br><span class="line">     * @param viewType</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123;</span><br><span class="line">        View v = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_home, parent, false);</span><br><span class="line">        return new ViewHolder(v);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 更新 View 内容</span><br><span class="line">     * @param holder</span><br><span class="line">     * @param position</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void onBindViewHolder(ViewHolder holder, final int position) &#123;</span><br><span class="line">        CommonDataBean item = items.get(position);</span><br><span class="line">        holder.tvItem.setText(item.getData());</span><br><span class="line">        holder.llLayout.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View view) &#123;</span><br><span class="line">                if (onItemClickListener !=null)&#123;</span><br><span class="line">                    onItemClickListener.onItemClick(view,position);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        holder.llLayout.setOnLongClickListener(new View.OnLongClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean onLongClick(View view) &#123;</span><br><span class="line">                if (onItemLongClickListener !=null)&#123;</span><br><span class="line">                    onItemLongClickListener.onItemLongClick(view,position);</span><br><span class="line">                &#125;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取 item 的总数</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public int getItemCount() &#123;</span><br><span class="line">        if (items == null) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        return items.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ViewHolder extends RecyclerView.ViewHolder &#123;</span><br><span class="line">        @BindView(R.id.tv_item)</span><br><span class="line">        TextView tvItem;</span><br><span class="line">        @BindView(R.id.ll_layout)</span><br><span class="line">        LinearLayout llLayout;</span><br><span class="line">        public ViewHolder(@NonNull View itemView) &#123;</span><br><span class="line">            super(itemView);</span><br><span class="line">            ButterKnife.bind(this,itemView);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>4.设置 RecycleView</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LinearLayoutManager manager = new LinearLayoutManager(this);</span><br><span class="line">recycleView.setLayoutManager(manager );</span><br><span class="line">recycleView.setAdapter(adapter);</span><br></pre></td></tr></table></figure>
<p>可以看到这里我们比起设置 LisView 来，我们多设置了一个 LinearLayoutManager。这里也是体现 RecycleView 比较灵活的一个点。它没有规定布局的排列样式，提供了一个 LayoutManager ，只要去修改 LayoutManager ，就可以修改布局的样式。我们这里实现 LinearLayoutManager ，类似 ListView 的一个样式。剩余的关于 LayoutManager  后面单独再说。</p>
<p>好了，我们来看一下设置后的效果：<br><img src="https://i.loli.net/2019/01/13/5c3b3ae2dfd3c.gif" alt="2.gif"></p>
<p><strong>5. 添加点击事件</strong><br>RecycleView 并没有像 ListView 那样直接提供 item 的行点击事件。所以需要我们自己实现，也很简单，在 adapter 中定义点击事件的接口。然后在 Activity 中实现这个接口即可。<br>adapter 中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     *  事件监听</span><br><span class="line">     */</span><br><span class="line">    private onItemClickListener onItemClickListener;</span><br><span class="line">    private onItemLongClickListener onItemLongClickListener;</span><br><span class="line"></span><br><span class="line">    public interface onItemClickListener&#123;</span><br><span class="line">        void  onItemClick(View view, int position);</span><br><span class="line">    &#125;</span><br><span class="line">    public interface onItemLongClickListener&#123;</span><br><span class="line">        void  onItemLongClick(View view, int position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void  setOnItemClickListener (onItemClickListener onItemClickListener)&#123;</span><br><span class="line">        this.onItemClickListener = onItemClickListener;</span><br><span class="line">    &#125;</span><br><span class="line">    public void  setOnItemLongClickListener (onItemLongClickListener onItemLongClickListener)&#123;</span><br><span class="line">        this.onItemLongClickListener = onItemLongClickListener;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>activity 中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">commonRvAdapter.setOnItemClickListener(new CommonRvAdapter.onItemClickListener() &#123;</span><br><span class="line">           @Override</span><br><span class="line">           public void onItemClick(View view, int position) &#123;</span><br><span class="line">               Toast.makeText(BasicRvActivity.this, &quot;点击&quot; + dataBeanList.get(position).getData() , Toast.LENGTH_SHORT).show();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">       commonRvAdapter.setOnItemLongClickListener(new CommonRvAdapter.onItemLongClickListener() &#123;</span><br><span class="line">           @Override</span><br><span class="line">           public void onItemLongClick(View view, int position) &#123;</span><br><span class="line">               Toast.makeText(BasicRvActivity.this, &quot;长按&quot; + dataBeanList.get(position).getData() , Toast.LENGTH_SHORT).show();</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure>
<p>再来看下效果：<br><img src="https://i.loli.net/2019/01/13/5c3b3ae308d9b.gif" alt="3.gif"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>好了，我们已经完成了基本的数据展示，非常的简单。本来是想跳过这一节的，但是还是记录一下的好，虽然简单，但还是得一步步的来，防止自己眼高手低。</p>
<p>不过好像缺了点装饰，比如分割线。那我们下篇博客就来探索一下！</p>
<p>demo 地址： <a href="https://github.com/xiaxiayang/AdvancedPractice" target="_blank" rel="noopener">点这里</a></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView" target="_blank" rel="noopener">https://developer.android.com/reference/android/support/v7/widget/RecyclerView</a></li>
<li><a href="https://developer.android.com/reference/android/widget/ListView" target="_blank" rel="noopener">https://developer.android.com/reference/android/widget/ListView</a></li>
</ul>

          
        
      
    </div>
    
    
    
<div>
  
</div>
<div>
      
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xiaxiayang.github.io/2019/01/13/React Native -- 布局位置随输入框变化的问题处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiaxiayang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/25956745?s=400&u=3b875396982ce81f05ad70778ceee4e3daf8d909&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夏霂熠雨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/13/React Native -- 布局位置随输入框变化的问题处理/" itemprop="url">React Native -- 布局位置随输入框变化的问题处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-13T21:10:09+08:00">
                2019-01-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react-native/" itemprop="url" rel="index">
                    <span itemprop="name">react native</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/01/13/React Native -- 布局位置随输入框变化的问题处理/" class="leancloud_visitors" data-flag-title="React Native -- 布局位置随输入框变化的问题处理">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>℃</span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>在之前项目的开发过程中，下图这样的需求很是常见：<br><img src="https://i.loli.net/2019/01/13/5c3b39da60dbd.gif" alt="1.gif"><br>当键盘弹起时，某个布局正好在键盘之上，当键盘消失时，这个布局又回到页面最底部。</p>
<p>今天来讨论的就是这个功能我用过的方法及踩过的坑。</p>
<h3 id="方案1"><a href="#方案1" class="headerlink" title="方案1"></a>方案1</h3><p>首先我们观察到下面的一块布局（以下简称 “A” 布局）是随着键盘的弹起和消失来改变位置的，并且距离屏幕的底部正好是键盘的高度。<br>所以，第一个思路，设置 A 布局的位置方式为绝对定位，并且是计算距离父布局底部的位置为键盘的高度。<br>代码中定义一个展示键盘高度的变量 keyboardHeight ，然后设置键盘显示与消失的事件监听，并给 keyboardHeight  变量赋值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">    this.keyboardDidShow = Keyboard.addListener(&apos;keyboardDidShow&apos;, this.keyboardShow.bind(this));</span><br><span class="line">    this.keyboardDidHide = Keyboard.addListener(&apos;keyboardDidHide&apos;, this.keyboardHide.bind(this));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> keyboardShow(e)&#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">        keyboardHeight:e.endCoordinates.height</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">keyboardHide()&#123;</span><br><span class="line">     this.setState(&#123;</span><br><span class="line">        keyboardHeight:0</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在 render 方法中设置 A 布局的样式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">         return (</span><br><span class="line">         &lt;View style = &#123;&#123;flex:1&#125;&#125;&gt;</span><br><span class="line">            &lt;TextInput</span><br><span class="line">                 style=&#123;&#123;height: 140, borderColor: &apos;#999&apos;, borderWidth: 1,margin:15&#125;&#125;</span><br><span class="line">                 onChangeText=&#123;(text) =&gt; this.setState(&#123;text&#125;)&#125;</span><br><span class="line">                 placeholder=&#123;&apos;随便说点什么吧&apos;&#125;</span><br><span class="line">                 textAlignVertical = &#123;&apos;top&apos;&#125;</span><br><span class="line">             /&gt;</span><br><span class="line"></span><br><span class="line">             &lt;View style = &#123;[styles.bottomView,&#123;bottom:this.state.keyboardHeight&#125;]&#125;&gt;</span><br><span class="line">                &lt;TouchableOpacity onPress = &#123;()=&gt;&#123;alert(1)&#125;&#125;&gt;</span><br><span class="line">                  &lt;Image style = &#123;&#123;width:26,height:26,marginLeft:15&#125;&#125; resizeMode =&#123;&apos;contain&apos;&#125;source = &#123;require(&apos;../img/keyBoard.png&apos;)&#125;/&gt;</span><br><span class="line">                &lt;/TouchableOpacity&gt;</span><br><span class="line">                &lt;TouchableOpacity onPress = &#123;()=&gt;&#123;alert(1)&#125;&#125;&gt;</span><br><span class="line">                  &lt;Image style = &#123;&#123;width:26,height:26,marginRight:15&#125;&#125; resizeMode =&#123;&apos;contain&apos;&#125;source = &#123;require(&apos;../img/emoji.png&apos;)&#125;/&gt;</span><br><span class="line">                &lt;/TouchableOpacity&gt;</span><br><span class="line">             &lt;/View&gt;</span><br><span class="line">         &lt;/View&gt;</span><br><span class="line"></span><br><span class="line">         );</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">     const styles = StyleSheet.create(&#123;</span><br><span class="line"></span><br><span class="line">        bottomView:&#123;</span><br><span class="line">           position:&apos;absolute&apos;,</span><br><span class="line">           flexDirection:&apos;row&apos;,</span><br><span class="line">           height:48,width:&apos;100%&apos;,</span><br><span class="line">           backgroundColor:&apos;#DD4F43&apos;,</span><br><span class="line">           justifyContent:&apos;space-between&apos;,</span><br><span class="line">           alignItems:&apos;center&apos;</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure>
<p>然后，我们来看一下效果：<br><img src="https://i.loli.net/2019/01/13/5c3b39da5c6cc.gif" alt="2.gif"></p>
<p>咦，好像翻车了。<br>可以看到当键盘没有弹出的时候是好的，但是当键盘弹出后 A 布局就不见了。那这又有两种情况，一种是 A 布局在正确位置的上方，超出屏幕了，一种是在正确位置的下方，被键盘遮挡没弹起来。<br>那我们来将 A 布局的位置改为  <code>keyboardHeight -150</code></p>
<p> 看下效果：<br><img src="https://i.loli.net/2019/01/13/5c3b39d915319.gif" alt="3.gif"><br>嗯，A 布局出现了，并且是在键盘的上方。由此可见我们的第一个猜想是对的。<br>那我们不妨再大胆做个猜想，A 布局偏离正确位置的高度会不会就是一个键盘的高度呢？如果是这样的话，那我们 A 布局的 bottom 就应该为 <code>keyboardHeight - keyboardHeight</code>  即为 0！</p>
<p>改下代码，然后来看下效果<br><img src="https://i.loli.net/2019/01/13/5c3b39da44851.gif" alt="4.gif"><br>貌似完美！ 也就是在 android 上也不需要去计算键盘的高度，布局直接在键盘之上？这个原理我还不清楚，但感觉和输入框与软键盘之间的恩怨有联系。<br>然后我们再看下在 ios 上的表现，嗯，这里没有测试机，就不贴图了。但事实证明会有个问题，在 ios 上如果这样设置当键盘显示的时候，A 布局不会弹起来，而是还在屏幕的底部。所以，ios  还是要计算键盘的高度。</p>
<p>所以，最后适配如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;View style = &#123;[styles.bottomView,&#123;bottom:Platform.OS == &apos;ios&apos;? this.state.keyboardHeight:0&#125;]&#125;&gt;</span><br><span class="line">               &lt;TouchableOpacity onPress = &#123;()=&gt;&#123;alert(1)&#125;&#125;&gt;</span><br><span class="line">                 &lt;Image style = &#123;&#123;width:26,height:26,marginLeft:15&#125;&#125; resizeMode =&#123;&apos;contain&apos;&#125;source = &#123;require(&apos;../img/keyBoard.png&apos;)&#125;/&gt;</span><br><span class="line">               &lt;/TouchableOpacity&gt;</span><br><span class="line">               &lt;TouchableOpacity onPress = &#123;()=&gt;&#123;alert(1)&#125;&#125;&gt;</span><br><span class="line">                 &lt;Image style = &#123;&#123;width:26,height:26,marginRight:15&#125;&#125; resizeMode =&#123;&apos;contain&apos;&#125;source = &#123;require(&apos;../img/emoji.png&apos;)&#125;/&gt;</span><br><span class="line">               &lt;/TouchableOpacity&gt;</span><br><span class="line">            &lt;/View&gt;</span><br></pre></td></tr></table></figure>
<p>在这种方案实行了俩星期后，测试就提出来严重的兼容性问题：</p>
<ul>
<li>在某些 android 手机上（如魅蓝），键盘弹起时，A 布局会距离键盘上方大约一个键盘的高度，即弹的太上了</li>
<li>在某些 android 手机 或者 iPhoneX 上，键盘弹起时 A 布局弹不出来</li>
</ul>
<p>这两个问题都是偶现的，但在某些机型上的偶现率达 50%<br>所以，看来方案一是有问题。<br>但问题究竟出在哪里，我没弄明白，但敢肯定还是和输入框与软键盘的适配有关，曾经尝试设置 activity 的 softnput 参数，未果。</p>
<h3 id="方案2"><a href="#方案2" class="headerlink" title="方案2"></a>方案2</h3><p>那我们就来换种思路，方案一我们是采用基于 bottom 的定位。但也许由于软键盘与输入框的特殊关系，这个 bottom 的值在不同机型上表现不同。那我们能否改为基于 top 定位呢。<br>分析一下，如果是基于 top 定位的情况，值应该怎么算，来看一下分析图：<br><img src="https://i.loli.net/2019/01/13/5c3b39d908c6d.png" alt="5.png"></p>
<ul>
<li>当键盘没有弹起的时候，A 布局距离父布局的顶部的距离是 <code>h- bottomHeight</code>，即父布局高度减去 A 布局自身高度。</li>
<li><p>当键盘弹起时，A 布局距离父布局的顶部的距离是 <code>h- bottomHeight-keyboardHeight</code>，即多减掉键盘的高度。</p>
<p>所以最终计算方式为：父布局的高度 - A 布局自身的高度 - 键盘的高度</p>
<p>代码中，我们首先需要计算一下父布局的高度，通过 onLayout 方法计算出。然后设置 A 布局的 top 属性值</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">_onLayout(event) &#123;</span><br><span class="line">       //获取根View的宽高，以及左上角的坐标值</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">           layoutHeight : 1</span><br><span class="line">        &#125;)</span><br><span class="line">     &#125;</span><br><span class="line">      render() &#123;</span><br><span class="line">         return (</span><br><span class="line">         &lt;View style = &#123;&#123;flex:1&#125;&#125;  onLayout=&#123;()=&gt;&#123;this._onLayout&#125;&#125;&gt;</span><br><span class="line">            &lt;TextInput</span><br><span class="line">                 style=&#123;&#123;height: 140, borderColor: &apos;#999&apos;, borderWidth: 1,margin:15&#125;&#125;</span><br><span class="line">                 onChangeText=&#123;(text) =&gt; this.setState(&#123;text&#125;)&#125;</span><br><span class="line">                 placeholder=&#123;&apos;随便说点什么吧&apos;&#125;</span><br><span class="line">                 textAlignVertical = &#123;&apos;top&apos;&#125;</span><br><span class="line">             /&gt;</span><br><span class="line"></span><br><span class="line">             &lt;View style = &#123;[styles.bottomView,&#123;top:520-48-this.state.keyboardHeight&#125;]&#125;&gt;</span><br><span class="line">                &lt;TouchableOpacity onPress = &#123;()=&gt;&#123;alert(1)&#125;&#125;&gt;</span><br><span class="line">                  &lt;Image style = &#123;&#123;width:26,height:26,marginLeft:15&#125;&#125; resizeMode =&#123;&apos;contain&apos;&#125;source = &#123;require(&apos;../img/keyBoard.png&apos;)&#125;/&gt;</span><br><span class="line">                &lt;/TouchableOpacity&gt;</span><br><span class="line">                &lt;TouchableOpacity onPress = &#123;()=&gt;&#123;alert(1)&#125;&#125;&gt;</span><br><span class="line">                  &lt;Image style = &#123;&#123;width:26,height:26,marginRight:15&#125;&#125; resizeMode =&#123;&apos;contain&apos;&#125;source = &#123;require(&apos;../img/emoji.png&apos;)&#125;/&gt;</span><br><span class="line">                &lt;/TouchableOpacity&gt;</span><br><span class="line">             &lt;/View&gt;</span><br><span class="line">         &lt;/View&gt;</span><br><span class="line"></span><br><span class="line">         );</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>刷新一下，看一下效果：<br><img src="https://i.loli.net/2019/01/13/5c3b39da53736.gif" alt="6.gif"></p>
<p>貌似没什么毛病，通过在其他机型和 ios 上测试，目前没有发现问题。</p>
<p>所以第二种方案可行。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>以后遇到这种需求，最好要避免根据 bottom 来定位，可以换种思路，根据 top 来定位。</p>

          
        
      
    </div>
    
    
    
<div>
  
</div>
<div>
      
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xiaxiayang.github.io/2019/01/13/android -- String 格式化使用示例/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiaxiayang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/25956745?s=400&u=3b875396982ce81f05ad70778ceee4e3daf8d909&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夏霂熠雨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/13/android -- String 格式化使用示例/" itemprop="url">android -- String 格式化使用示例</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-13T21:02:34+08:00">
                2019-01-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/01/13/android -- String 格式化使用示例/" class="leancloud_visitors" data-flag-title="android -- String 格式化使用示例">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>℃</span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>这篇文章已经拖了快一个月。。虽然简单，还是总结一下吧。</p>
<p>最近做项目的时候遇到群发短信消息的需求，然后有个短信模板，大致格式如下 : </p>
<blockquote>
<p> {userName} 在 {appName} 中对您发布了新的消息 ：{message} 快去查看吧。</p>
</blockquote>
<p>也就是在创建短信消息体的时候会有 3 个变量 ，然后你估计会问，这有什么问题？ 嗯，确实没啥大问题。<br>所以我们这里来讨论的，是对于这个消息体字符串的创建我们有哪些方法，而哪个方法又显得比较优雅。</p>
<h3 id="字符串拼接的方法"><a href="#字符串拼接的方法" class="headerlink" title="字符串拼接的方法"></a>字符串拼接的方法</h3><p>1、首先最原始、最粗暴的方法，用 ”+“ 号拼接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">private  String  createMessageBody(String userName , String appName,String message  )&#123; </span><br><span class="line">        String messageBody = userName + &quot;在&quot; + appName + &quot;中对您发布了新的消息 ：&quot; + message + &quot; 快去查看吧。&quot;;</span><br><span class="line">         return  messageBody;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>貌似也没什么不好的地方，但这么多加号拼接在一起，恩， 有种 low low 的感觉</p>
<p>2、StringBuilder 拼接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private  String  createMessageBody(String userName , String appName,String message  )&#123;</span><br><span class="line">      StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">      stringBuilder.append(userName)</span><br><span class="line">              .append(&quot;在&quot;)</span><br><span class="line">              .append(appName)</span><br><span class="line">              .append(&quot;中对您发布了新的消息 ：&quot;)</span><br><span class="line">              .append(message)</span><br><span class="line">              .append(&quot;快去查看吧 。&quot;);</span><br><span class="line">      return  stringBuilder.toString();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>恩，这种方法貌似看起来也比较臃肿，可读性也不好。只是比第一种效率高，不会产生那么多对象。</p>
<p>3、字符串模板拼接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xml 中 :  &lt;string name=&quot;message_body&quot;&gt;%1$s在%2$s中对您发布了新的消息：%3$s。快去查看吧。&lt;/string&gt;</span><br><span class="line"></span><br><span class="line">private  String  createMessageBody(String userName , String appName,String message  )&#123;</span><br><span class="line">       String messageBody = getResources().getString(R.string.message_body,userName,appName,message);</span><br><span class="line">       return messageBody;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到这种方法是需要首先在 <strong>string</strong> 文件夹下定义好完整的文字，然后在代码中通过 <code>getString</code> 方法，传入条件参数。<br>很显然，这种方法更符合开发规范，因为我们一般是要尽量避免在代码中直接明文写字符串的。</p>
<p>还有，对于支持多语言的应用，前两种方法就更不值得用了。</p>
<p>然后，我们来看一下 android 中 <code>getString(@StringRes int id, Object... formatArgs)</code> 这个方法内部是怎么实现的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@NonNull</span><br><span class="line">public String getString(@StringRes int id, Object... formatArgs) throws NotFoundException &#123;</span><br><span class="line">    final String raw = getString(id);</span><br><span class="line">    return String.format(mResourcesImpl.getConfiguration().getLocales().get(0), raw,</span><br><span class="line">            formatArgs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，最终调用的是 java  中 String 的 format 方法。</p>
<h3 id="Java-String-格式化"><a href="#Java-String-格式化" class="headerlink" title="Java String 格式化"></a>Java String 格式化</h3><p>这个本来想详细列举一下，但是发现有一篇译文写得很详细，可以作为速查表：<br><a href="https://blog.csdn.net/isea533/article/details/70193652" target="_blank" rel="noopener">isea533 – Java String 格式化示例</a></p>
<p>这里简单贴一下文章中常用的格式说明符：<br><img src="https://i.loli.net/2019/01/13/5c3b387c5cb3f.jpg" alt="20181225175236121.jpg"><br>剩余的这里就不再讲解。。。直接结束</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>恩，这就结束了（😂）</p>
<p>看起来像一篇水文（尴尬）</p>
<p>所以以后遇到需要字符串格式化或者拼接的时候可以优先考虑一下  String.format 方法。来减少直接在代码中输入文字。</p>
<p>PS : 前两天看的 kotlin 的字符串模板挺好用的，但是也相当于是直接硬编码了。</p>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p><a href="https://blog.csdn.net/isea533/article/details/70193652" target="_blank" rel="noopener">isea533 – Java String 格式化示例</a></p>

          
        
      
    </div>
    
    
    
<div>
  
</div>
<div>
      
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xiaxiayang.github.io/2018/12/03/android -- EditText 设置 imeOptions 属性为何失效？/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiaxiayang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/25956745?s=400&u=3b875396982ce81f05ad70778ceee4e3daf8d909&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夏霂熠雨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/03/android -- EditText 设置 imeOptions 属性为何失效？/" itemprop="url">android -- EditText 设置 imeOptions 属性为何失效？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-03T22:57:13+08:00">
                2018-12-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/12/03/android -- EditText 设置 imeOptions 属性为何失效？/" class="leancloud_visitors" data-flag-title="android -- EditText 设置 imeOptions 属性为何失效？">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>℃</span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>最近改 bug 的时候碰到一个小知识点，在搜索界面希望键盘上的 enter 键改为搜索按钮。也就是下图的效果，是不是非常常见。<br><img src="https://img-blog.csdnimg.cn/20181202203641503.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzNzAzODc3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>然后我就记得 Editext 有个 imeOptions 的属性，可以设置 enter 键的效果。所以果断在 xml 中写下 <code>android:imeOptions=&quot;actionSearch&quot;</code>，然后把问题改为已修复，信心满满。结果等编译运行起来在手机上发现没有起作用，还是 enter 键。 搜索了一下，发现大家都是这样回答的：</p>
<blockquote>
<p>如果设置了 imeOptions 属性，键盘没有变化 ，那么需要单独加一些其他的属性配合使用，xml中 属性设置：<br>1 将singleLine设置为true<br>2 或者将inputType设置为text</p>
</blockquote>
<p>试了一下，果然 ok 了。但为什么这样设置显示就对了呢？你是不是同样也有疑问？ 所以就让我们共同去探寻答案吧！</p>
<h4 id="ImeOptions-属性源码解析"><a href="#ImeOptions-属性源码解析" class="headerlink" title="ImeOptions 属性源码解析"></a>ImeOptions 属性源码解析</h4><p>这里首先推荐一个看源码的插件：<a href="https://github.com/pengwei1024/AndroidSourceViewer" target="_blank" rel="noopener">AndroidSourceView</a>。</p>
<h5 id="Step1"><a href="#Step1" class="headerlink" title="Step1"></a>Step1</h5><p>因为如果是在 JAVA 文件中，我们设置 imeOptions  属性代码为： <code>editText.setImeOptions(EditorInfo.IME_ACTION_SEARCH);</code><br>所以首先要定位到 <code>setImeOptions()</code> 这个方法 ，在 EdiText 中没有搜到，所以果断跳到 EditText 的父类 TextView 的源码中，然后发现目标：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * Change the editor type integer associated with the text view, which</span><br><span class="line">    * is reported to an Input Method Editor (IME) with &#123;@link EditorInfo#imeOptions&#125;</span><br><span class="line">    * when it has focus.</span><br><span class="line">    * @see #getImeOptions</span><br><span class="line">    * @see android.view.inputmethod.EditorInfo</span><br><span class="line">    * @attr ref android.R.styleable#TextView_imeOptions</span><br><span class="line">    * 当输入法编译器(IME)获取焦点的时候,通过&#123;@link EditorInfo#imeOptions&#125; 报告给输入法编辑器，</span><br><span class="line">    * 来更改与文本视图关联的编辑器类型值。</span><br><span class="line">    */</span><br><span class="line">   public void setImeOptions(int imeOptions) &#123;</span><br><span class="line">      //1.判断是否需要创建 Editor 对象</span><br><span class="line">       createEditorIfNeeded();</span><br><span class="line">       //2.判断是否需要创建 InputContentType </span><br><span class="line">       mEditor.createInputContentTypeIfNeeded();</span><br><span class="line">       //3. 将入参赋值给InputContentType.imeOptions</span><br><span class="line">       mEditor.mInputContentType.imeOptions = imeOptions;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>这个方法里面只是进行了判断是否需要创建一些对象，然后将我们的入参赋值给 InputContentType.imeOptions。从这方法的注释中我们可以知道关键对象是 <strong><code>EditorInfo#imeOptions</code></strong> 。</p>
<h5 id="Step2"><a href="#Step2" class="headerlink" title="Step2"></a>Step2</h5><p>继续搜索关键字  imeOptions ，然后发现下面这个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">   public InputConnection onCreateInputConnection(EditorInfo outAttrs) &#123;</span><br><span class="line">       if (onCheckIsTextEditor() &amp;&amp; isEnabled()) &#123;</span><br><span class="line">           mEditor.createInputMethodStateIfNeeded();</span><br><span class="line">           outAttrs.inputType = getInputType();</span><br><span class="line">           if (mEditor.mInputContentType != null) &#123;</span><br><span class="line">               outAttrs.imeOptions = mEditor.mInputContentType.imeOptions;</span><br><span class="line">               outAttrs.privateImeOptions = mEditor.mInputContentType.privateImeOptions;</span><br><span class="line">               outAttrs.actionLabel = mEditor.mInputContentType.imeActionLabel;</span><br><span class="line">               outAttrs.actionId = mEditor.mInputContentType.imeActionId;</span><br><span class="line">               outAttrs.extras = mEditor.mInputContentType.extras;</span><br><span class="line">               outAttrs.hintLocales = mEditor.mInputContentType.imeHintLocales;</span><br><span class="line">           &#125; else &#123;</span><br><span class="line">               outAttrs.imeOptions = EditorInfo.IME_NULL;</span><br><span class="line">               outAttrs.hintLocales = null;</span><br><span class="line">           &#125;</span><br><span class="line">           if (focusSearch(FOCUS_DOWN) != null) &#123;</span><br><span class="line">               outAttrs.imeOptions |= EditorInfo.IME_FLAG_NAVIGATE_NEXT;</span><br><span class="line">           &#125;</span><br><span class="line">           if (focusSearch(FOCUS_UP) != null) &#123;</span><br><span class="line">               outAttrs.imeOptions |= EditorInfo.IME_FLAG_NAVIGATE_PREVIOUS;</span><br><span class="line">           &#125;</span><br><span class="line">           if ((outAttrs.imeOptions &amp; EditorInfo.IME_MASK_ACTION)</span><br><span class="line">                   == EditorInfo.IME_ACTION_UNSPECIFIED) &#123;</span><br><span class="line">               if ((outAttrs.imeOptions &amp; EditorInfo.IME_FLAG_NAVIGATE_NEXT) != 0) &#123;</span><br><span class="line">                   // An action has not been set, but the enter key will move to</span><br><span class="line">                   // the next focus, so set the action to that.</span><br><span class="line">                   outAttrs.imeOptions |= EditorInfo.IME_ACTION_NEXT;</span><br><span class="line">               &#125; else &#123;</span><br><span class="line">                   // An action has not been set, and there is no focus to move</span><br><span class="line">                   // to, so let&apos;s just supply a &quot;done&quot; action.</span><br><span class="line">                   outAttrs.imeOptions |= EditorInfo.IME_ACTION_DONE;</span><br><span class="line">               &#125;</span><br><span class="line">               if (!shouldAdvanceFocusOnEnter()) &#123;</span><br><span class="line">                   outAttrs.imeOptions |= EditorInfo.IME_FLAG_NO_ENTER_ACTION;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           if (isMultilineInputType(outAttrs.inputType)) &#123;</span><br><span class="line">               // Multi-line text editors should always show an enter key.</span><br><span class="line">               outAttrs.imeOptions |= EditorInfo.IME_FLAG_NO_ENTER_ACTION;</span><br><span class="line">           &#125;</span><br><span class="line">           outAttrs.hintText = mHint;</span><br><span class="line">           if (mText instanceof Editable) &#123;</span><br><span class="line">               InputConnection ic = new EditableInputConnection(this);</span><br><span class="line">               outAttrs.initialSelStart = getSelectionStart();</span><br><span class="line">               outAttrs.initialSelEnd = getSelectionEnd();</span><br><span class="line">               outAttrs.initialCapsMode = ic.getCursorCapsMode(getInputType());</span><br><span class="line">               return ic;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       return null;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>然后我们只关心我们探究的信息，所以<strong>伪代码</strong>如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public InputConnection onCreateInputConnection(EditorInfo outAttrs) &#123;</span><br><span class="line">            //  return mEditor == null ? EditorInfo.TYPE_NULL : mEditor.mInputType</span><br><span class="line">            outAttrs.inputType = getInputType();</span><br><span class="line">            if (mEditor.mInputContentType != null) &#123;</span><br><span class="line">                outAttrs.imeOptions = mEditor.mInputContentType.imeOptions;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                outAttrs.imeOptions = EditorInfo.IME_NULL;</span><br><span class="line">            &#125;</span><br><span class="line">            if (focusSearch(FOCUS_DOWN) != null) &#123;</span><br><span class="line">                outAttrs.imeOptions |= EditorInfo.IME_FLAG_NAVIGATE_NEXT;</span><br><span class="line">            &#125;</span><br><span class="line">            if (focusSearch(FOCUS_UP) != null) &#123;</span><br><span class="line">                outAttrs.imeOptions |= EditorInfo.IME_FLAG_NAVIGATE_PREVIOUS;</span><br><span class="line">            &#125;</span><br><span class="line">            if ((outAttrs.imeOptions &amp; EditorInfo.IME_MASK_ACTION)</span><br><span class="line">                    == EditorInfo.IME_ACTION_UNSPECIFIED) &#123;</span><br><span class="line">             //..代码省略</span><br><span class="line">            &#125;</span><br><span class="line">            if (isMultilineInputType(outAttrs.inputType)) &#123;</span><br><span class="line">                // Multi-line text editors should always show an enter key.</span><br><span class="line">                //多行文本编译器总是会显示 enter 键</span><br><span class="line">                outAttrs.imeOptions |= EditorInfo.IME_FLAG_NO_ENTER_ACTION;</span><br><span class="line">            &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="Step3"><a href="#Step3" class="headerlink" title="Step3"></a>Step3</h5><p>我们首先分析一下：</p>
<ul>
<li>第一个 if 判断： <code>mEditor.mInputContentType</code> 这个值是否为空，答案是 false ，因为我们在<code>setImeOptions</code> 方法的第 3 步已经给它赋值了，所以不会为空，所以<code>outAttrs.imeOptions</code> 结果为我们设置的值</li>
<li>第二个 if 判断：是来寻找我们的 Editext 对象的往下的一个方向是否存在可以获取焦点的 View，这个得看实际输入框下面布局是否还会有一个输入框，目前项目没有，所以 false</li>
<li>第三个 if 判断：跟第二个条件一样，只过是方向为向上查找</li>
<li><p>第四个 if 判断：首先 <code>(outAttrs.imeOptions &amp; EditorInfo.IME_MASK_ACTION</code>值是多少呢，我们代码里设置的值是 <code>IME_ACTION_SEARCH</code> ，值为 3，<code>EditorInfo.IME_MASK_ACTION</code> 的值为 255 ,取二进制值为 00000011 &amp; 1111 1111 = 00000011 十进制为 3，而<code>EditorInfo.IME_ACTION_UNSPECIFIED</code> 值为 0，所以结果为 false。</p>
<p>到目前为止 <strong><code>outAttrs.imeOptions</code></strong> 的结果依然为我们在代码中设置的值。</p>
<h5 id="Step4"><a href="#Step4" class="headerlink" title="Step4"></a>Step4</h5><p>来看最后一个 if 判断：<code>isMultilineInputType(outAttrs.inputType)</code> 光看字段意思我们能猜到判断输入框是不是多行输入。看一下具体代码：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">private static boolean isMultilineInputType(int type) &#123;</span><br><span class="line">        return (type &amp; (EditorInfo.TYPE_MASK_CLASS | EditorInfo.TYPE_TEXT_FLAG_MULTI_LINE))</span><br><span class="line">                == (EditorInfo.TYPE_CLASS_TEXT | EditorInfo.TYPE_TEXT_FLAG_MULTI_LINE);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>type 这个值为我们在 onCreateInputConnection() 方法中通过getInputType () 方法获取，结果为返回我们代码中设置的 inputType 值，而我们代码中没有设置，那么这个 inputType 的默认值是什么呢？源码中没有找到，然后我自己 debug 了一下，结果如下图：<br><img src="https://img-blog.csdnimg.cn/2018120321243029.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzNzAzODc3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>所以默认值为 131073，而 InputType 各种类型的值如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public interface InputType &#123;</span><br><span class="line">    int TYPE_CLASS_DATETIME = 4;</span><br><span class="line">    int TYPE_CLASS_NUMBER = 2;</span><br><span class="line">    int TYPE_CLASS_PHONE = 3;</span><br><span class="line">    int TYPE_CLASS_TEXT = 1;</span><br><span class="line">    int TYPE_DATETIME_VARIATION_DATE = 16;</span><br><span class="line">    int TYPE_DATETIME_VARIATION_NORMAL = 0;</span><br><span class="line">    int TYPE_DATETIME_VARIATION_TIME = 32;</span><br><span class="line">    int TYPE_MASK_CLASS = 15;</span><br><span class="line">    int TYPE_MASK_FLAGS = 16773120;</span><br><span class="line">    int TYPE_MASK_VARIATION = 4080;</span><br><span class="line">    int TYPE_NULL = 0;</span><br><span class="line">    int TYPE_NUMBER_FLAG_DECIMAL = 8192;</span><br><span class="line">    int TYPE_NUMBER_FLAG_SIGNED = 4096;</span><br><span class="line">    int TYPE_NUMBER_VARIATION_NORMAL = 0;</span><br><span class="line">    int TYPE_NUMBER_VARIATION_PASSWORD = 16;</span><br><span class="line">    int TYPE_TEXT_FLAG_AUTO_COMPLETE = 65536;</span><br><span class="line">    int TYPE_TEXT_FLAG_AUTO_CORRECT = 32768;</span><br><span class="line">    int TYPE_TEXT_FLAG_CAP_CHARACTERS = 4096;</span><br><span class="line">    int TYPE_TEXT_FLAG_CAP_SENTENCES = 16384;</span><br><span class="line">    int TYPE_TEXT_FLAG_CAP_WORDS = 8192;</span><br><span class="line">    int TYPE_TEXT_FLAG_IME_MULTI_LINE = 262144;</span><br><span class="line">    int TYPE_TEXT_FLAG_MULTI_LINE = 131072;</span><br><span class="line">    int TYPE_TEXT_FLAG_NO_SUGGESTIONS = 524288;</span><br><span class="line">    int TYPE_TEXT_VARIATION_EMAIL_ADDRESS = 32;</span><br><span class="line">    int TYPE_TEXT_VARIATION_EMAIL_SUBJECT = 48;</span><br><span class="line">    int TYPE_TEXT_VARIATION_FILTER = 176;</span><br><span class="line">    int TYPE_TEXT_VARIATION_LONG_MESSAGE = 80;</span><br><span class="line">    int TYPE_TEXT_VARIATION_NORMAL = 0;</span><br><span class="line">    int TYPE_TEXT_VARIATION_PASSWORD = 128;</span><br><span class="line">    int TYPE_TEXT_VARIATION_PERSON_NAME = 96;</span><br><span class="line">    int TYPE_TEXT_VARIATION_PHONETIC = 192;</span><br><span class="line">    int TYPE_TEXT_VARIATION_POSTAL_ADDRESS = 112;</span><br><span class="line">    int TYPE_TEXT_VARIATION_SHORT_MESSAGE = 64;</span><br><span class="line">    int TYPE_TEXT_VARIATION_URI = 16;</span><br><span class="line">    int TYPE_TEXT_VARIATION_VISIBLE_PASSWORD = 144;</span><br><span class="line">    int TYPE_TEXT_VARIATION_WEB_EDIT_TEXT = 160;</span><br><span class="line">    int TYPE_TEXT_VARIATION_WEB_EMAIL_ADDRESS = 208;</span><br><span class="line">    int TYPE_TEXT_VARIATION_WEB_PASSWORD = 224;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结合 stackoverflow 上 <a href="https://stackoverflow.com/questions/22524904/default-inputtype-of-edittext-in-android" target="_blank" rel="noopener">Default inputType of EditText in android</a> 答案和 InputType 的值，也就是说 inputType 默认值 为 <code>InputType.TYPE_CLASS_TEXT|InputType.TYPE_TEXT_FLAG_MULTI_LINE</code> 组合的结果。</p>
<p>然后我们继续往下看，isMultilineInputType() 方法的返回值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(type &amp; (EditorInfo.TYPE_MASK_CLASS | EditorInfo.TYPE_TEXT_FLAG_MULTI_LINE))</span><br><span class="line">                == (EditorInfo.TYPE_CLASS_TEXT | EditorInfo.TYPE_TEXT_FLAG_MULTI_LINE</span><br></pre></td></tr></table></figure>
<p>转换为十进制为：<code>(131073 &amp; (15 | 131072)) == 1 | 131072</code><br>转换为二进制为：<code>(100000000000000001 &amp;(1111 | 100000000000000000)) == 1 | 100000000000000000</code><br>即 <code>100000000000000001  == 100000000000000001</code><br>即 true。</p>
<p>所以会进入最后一个条件中，而该返回值明确指出 <strong>多行文本编译器总是会显示 enter 键</strong> 。所以我们会看到我们设置的属性<strong>失效</strong>了。</p>
<p>而如果我们设置了 <code>singleLine = true</code> ，源码中是这样设置的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * Adds or remove the EditorInfo.TYPE_TEXT_FLAG_MULTI_LINE on the mInputType.</span><br><span class="line">    * @param singleLine</span><br><span class="line">    */</span><br><span class="line">   private void setInputTypeSingleLine(boolean singleLine) &#123;</span><br><span class="line">       if (mEditor != null</span><br><span class="line">               &amp;&amp; (mEditor.mInputType &amp; EditorInfo.TYPE_MASK_CLASS)</span><br><span class="line">                       == EditorInfo.TYPE_CLASS_TEXT) &#123;</span><br><span class="line">           if (singleLine) &#123;</span><br><span class="line">               mEditor.mInputType &amp;= ~EditorInfo.TYPE_TEXT_FLAG_MULTI_LINE;</span><br><span class="line">           &#125; else &#123;</span><br><span class="line">               mEditor.mInputType |= EditorInfo.TYPE_TEXT_FLAG_MULTI_LINE;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>如果 singleLine 为 true，inputType = ~ 131072，即011111111111111111 ，最后计算结果为 <code>111111111111111111  == 100000000000000001</code>，显然 false。<br>或者设置了inputType = TYPE_CLASS_TEXT 我们也可以得出返回值为 false，所以不会进判断条件，也就是 imeOptions 的值就是我们在代码里或者 xml 中设置的。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>所以要让 imeOptions  起作用，关键是不能满足 可以多行输入的属性。<br> 有两种处理方案：</p>
<blockquote>
<p><strong><font color="black"> 1. 设置 singleLine 属性为 true</font></strong><br><strong><font color="green">2. 设置 inputType 属性。 而这个属性值不一定非要是 ‘text’ 即TYPE_CLASS_TEXT 类型，只要最后结果不是 131072 （也就是 InputType.TYPE_CLASS_TEXT |InputType.TYPE_TEXT_FLAG_MULTI_LINE 即可，根据需求来定是 设置 text 或者 纯数字键盘等等）</font></strong></p>
</blockquote>
<h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h4><p><a href="https://developer.android.google.cn/reference/android/view/inputmethod/EditorInfo" target="_blank" rel="noopener">EditorInfo文档</a><br><a href="https://blog.csdn.net/lastdream/article/details/24365633" target="_blank" rel="noopener">EditText中imeOptions属性使用及设置无效解决</a><br><a href="http://tool.oschina.net/hexconvert" target="_blank" rel="noopener">在线进制转换</a></p>

          
        
      
    </div>
    
    
    
<div>
  
</div>
<div>
      
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xiaxiayang.github.io/2018/12/03/React Native --踩坑记 之 创建指定 React Native版本的项目/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiaxiayang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/25956745?s=400&u=3b875396982ce81f05ad70778ceee4e3daf8d909&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夏霂熠雨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/03/React Native --踩坑记 之 创建指定 React Native版本的项目/" itemprop="url">React Native --踩坑记 之 创建指定 React Native版本的项目</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-03T22:53:23+08:00">
                2018-12-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react-native/" itemprop="url" rel="index">
                    <span itemprop="name">react native</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/12/03/React Native --踩坑记 之 创建指定 React Native版本的项目/" class="leancloud_visitors" data-flag-title="React Native --踩坑记 之 创建指定 React Native版本的项目">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>℃</span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前-言"><a href="#前-言" class="headerlink" title="前 言"></a>前 言</h3><p>最近一段时间一直在写    RN 的项目，期间遇到了挺多的坑，然后想着记录一下填坑的过程（想看答案的小伙伴可以忽略我的心厉路程，直接跳到结尾总结处）。</p>
<h4 id="step1-我竟然偷偷的给自己挖了个坑？"><a href="#step1-我竟然偷偷的给自己挖了个坑？" class="headerlink" title="step1. 我竟然偷偷的给自己挖了个坑？"></a>step1. 我竟然偷偷的给自己挖了个坑？</h4><p>于是乎，第一步，赶紧新建一个demo，飞快地在  terminal 中输入 <code>react native init yx_rnDemo</code> ,漫长的等待后，项目成功建立。 然后用 IDE 打开 demo ，执行<code>react-native run-android</code> 命令，结果半路夭折，没跑起来。仔细一看错误日志，发现 android 各种依赖都下载失败。然后看了下 <code>package.json</code> 中 react-native 的版本，发现引用的是最新版本，然后点击查看 android 文件夹，发现引用的 gradle 版本是 3.1.4  ,然鹅我用的还是 2.3.3 的版本。。</p>
<p>因为比较懒（这句话在我的博客中出现的次数不低，懒是万恶之源，罪过罪过~~），不想升级，再配置一系列东西，所以按照 中文网 给出的创建指定版本的方法：</p>
<blockquote>
<p>提示：你可以使用–version参数（注意是两个杠）创建指定版本的项目。例如react-native init MyApp –version 0.44.3。注意版本号必须精确到两个小数点</p>
</blockquote>
<p>删掉 demo ，重新输入 <code>react native init yx_rnDemo --version0.47.2</code>  ,结果最后发现其实创建的还是最新版。。（内心 OS，what？？其实细心的朋友估计已经发现问题了，哈哈，嘘~~）</p>
<p>然后开始各种面向搜索引擎，发现大家都是这样创建的啊，并且 RN 官网上给出的命令也是这样的，为什么别人没有问题，到我这就有问题了呢。</p>
<p>然后换了一个命令执行： <code>react-native init yx_rnDemo --verbose --version 0.47.2</code> 想来看一下创建项目的详细信息，结果最后显示创建的竟然是对的！！ 就是 0.47.2 。 </p>
<p>难道说加了一个 <code>--verbose</code> 条件就能创建成功了？不对啊，我看了下说 <code>--verbose</code>  条件只是会输出详细信息的啊，照理说不应该对结果产生什么影响的。然后不信邪的我把 <code>--verbose</code> 命令去掉，又执行了<code>react-native init yx_rnDemo  --version 0.47.2</code>，过了一会发现，竟然也是对的！！ </p>
<p>吓得我赶紧去翻我第一次写的命令，一对比，发现我第一个命令<code>--verison</code> 后没有换行~~</p>
<blockquote>
<p>第一次的：react native init yx_rnDemo –version0.47.2<br>第二次的：react-native init yx_rnDemo  –version 0.47.2</p>
</blockquote>
<p>本来到这就可以结束的，然而作为一个想有灵魂的程序猿，还是很想弄清楚为什么不加空格就会创建最新版本，而不是提示语法错误的原因。</p>
<h4 id="step2-一步步分析坑是如何产生的"><a href="#step2-一步步分析坑是如何产生的" class="headerlink" title="step2. 一步步分析坑是如何产生的"></a>step2. 一步步分析坑是如何产生的</h4><p>这里首先介绍一下， react-native 源码中 <a href="https://github.com/facebook/react-native/blob/83c7303a193fd0c998539be641ba2f8423cddd89/react-native-cli/index.js" target="_blank" rel="noopener">react-native-cli 文件夹下的 index.js </a> 这个文件很重要，它唯一的工作是初始化存储库，然后将所有命令转发到本地的 react-native 版本。所以我们初始化项目时做的操作可以在这个文件中找到。</p>
<p>打开这个 js 文件，然后开始一探究竟吧。<br><strong>1.</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">var fs = require(&apos;fs&apos;);</span><br><span class="line">var path = require(&apos;path&apos;);</span><br><span class="line">var exec = require(&apos;child_process&apos;).exec;</span><br><span class="line">var execSync = require(&apos;child_process&apos;).execSync;</span><br><span class="line">var chalk = require(&apos;chalk&apos;);</span><br><span class="line">var prompt = require(&apos;prompt&apos;);</span><br><span class="line">var semver = require(&apos;semver&apos;);</span><br><span class="line">/**</span><br><span class="line"> * Used arguments:</span><br><span class="line"> *   -v --version - to print current version of react-native-cli and react-native dependency</span><br><span class="line"> *   if you are in a RN app folder</span><br><span class="line"> * init - to create a new project and npm install it</span><br><span class="line"> *   --verbose - to print logs while init</span><br><span class="line"> *   --template - name of the template to use, e.g. --template navigation</span><br><span class="line"> *   --version &lt;alternative react-native package&gt; - override default (https://registry.npmjs.org/react-native@latest),</span><br><span class="line"> *      package to install, examples:</span><br><span class="line"> *     - &quot;0.22.0-rc1&quot; - A new app will be created using a specific version of React Native from npm repo</span><br><span class="line"> *     - &quot;https://registry.npmjs.org/react-native/-/react-native-0.20.0.tgz&quot; - a .tgz archive from any npm repo</span><br><span class="line"> *     - &quot;/Users/home/react-native/react-native-0.22.0.tgz&quot; - for package prepared with `npm pack`, useful for e2e tests</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">var options = require(&apos;minimist&apos;)(process.argv.slice(2));</span><br></pre></td></tr></table></figure>
<p>文件的前 62 行都是在声明变量及引用，其中有几个变量这里我们需要知道它们是的作用：</p>
<table>
<thead>
<tr>
<th style="text-align:left">变量名</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">fs</td>
<td style="text-align:left">Node.js 中 文件系统操作的模块</td>
</tr>
<tr>
<td style="text-align:left">path</td>
<td style="text-align:left">Node.js 中用于处理文件路径的小工具的模块</td>
</tr>
<tr>
<td style="text-align:left">exec</td>
<td style="text-align:left">Node.js 中子进程模块， 衍生一个 shell 并在 shell 上运行命令</td>
</tr>
<tr>
<td style="text-align:left">execSync</td>
<td style="text-align:left">exec 的同步函数，会阻塞 Node.js 事件循环</td>
</tr>
<tr>
<td style="text-align:left">chalk</td>
<td style="text-align:left">定制控制台日志的输入样式的一个插件</td>
</tr>
<tr>
<td style="text-align:left">prompt</td>
<td style="text-align:left">node 命令行输入控件</td>
</tr>
<tr>
<td style="text-align:left"><strong>semver</strong></td>
<td style="text-align:left"><strong>semver 语义化版本号</strong></td>
</tr>
<tr>
<td style="text-align:left"><strong>options</strong></td>
<td style="text-align:left"><strong>轻量级的命令行参数解析工具</strong></td>
</tr>
</tbody>
</table>
<p>其中一个很关键的变量 options ，也就是引用的<code>require(&#39;minimist&#39;)(process.argv.slice(2))</code> ，是一个命令行参数解析工具，具体的介绍可以<a href="https://jarvys.github.io/2014/06/01/minimist-js/" target="_blank" rel="noopener">参考这里</a>，它是以键值对进行解析的。比如我们输入的命令行是：<code>react-native init yx_rnDemo --version 0.47.2</code> ,其中 <code>--version 0.47.2</code> 就是一个可解析的键值对，key 为 version ， value 为 0.47.2 。</p>
<p>这个文件中，我们有用到的键值对的值在截图的注释中可以看到：</p>
<ul>
<li><code>-v</code> :  打印当前 react-native-cli 的版本和 react native 的依赖关系</li>
<li><code>init</code> ： 创建一个新工程并且执行 npm install </li>
<li><code>--verbose</code>: <code>init</code> 时添加的参数，打印<code>init</code>时的参数</li>
<li>-<code>-template</code>：用到的模板的名称</li>
<li><code>--version</code> ： 会覆盖默认（最新版本）安装的 react-native 的版本。 也就是如果要创建指定版本的，需要加上这个参数</li>
</ul>
<p>OK， 各个变量的含义我们都弄清楚了，下面让我们继续探究~~</p>
<p><strong>2.</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> switch (commands[0]) &#123;</span><br><span class="line">    case &apos;init&apos;:</span><br><span class="line">      if (!commands[1]) &#123;</span><br><span class="line">        console.error(&apos;Usage: react-native init &lt;ProjectName&gt; [--verbose]&apos;);</span><br><span class="line">        process.exit(1);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        init(commands[1], options);</span><br><span class="line">      &#125;</span><br><span class="line">      break;</span><br><span class="line">    default:</span><br><span class="line">     //...代码省略</span><br><span class="line">      break;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这之前 116  行 定义了 commands 这个变量，取值的结果是解析的参数，应该是 <code>_ [ &#39;init &#39;, &#39;yx_rnDEmo&#39;]</code>,所以会走switch 的第一个选项，去执行  <code>init(commands[1], options)</code> 方法,参数为 ‘yx_rnDemo’ 和 options 变量。</p>
<p><strong>3.</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param name Project name, e.g. &apos;AwesomeApp&apos;.</span><br><span class="line"> * @param options.verbose If true, will run &apos;npm install&apos; in verbose mode (for debugging).</span><br><span class="line"> * @param options.version Version of React Native to install, e.g. &apos;0.38.0&apos;.</span><br><span class="line"> * @param options.npm If true, always use the npm command line client,</span><br><span class="line"> *                       don&apos;t use yarn even if available.</span><br><span class="line"> */</span><br><span class="line">function init(name, options) &#123;</span><br><span class="line">  validateProjectName(name);</span><br><span class="line"></span><br><span class="line">  if (fs.existsSync(name)) &#123;</span><br><span class="line">    createAfterConfirmation(name, options);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    createProject(name, options);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很简单，先去判断我们起的工程名称是否符合命名规范，并且判断是否存在。所以下面直接看 <code>createProject(name, options)</code> 方法</p>
<p><strong>4.</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function createProject(name, options) &#123;</span><br><span class="line">   //....代码省略</span><br><span class="line">  run(root, projectName, options);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个方法里主要是去进行创建工程文件夹和 package.json 文件的操作，然后后续行动在<code>run(root, projectName, options)</code> 函数中</p>
<p><strong>5.</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function run(root, projectName, options) &#123;</span><br><span class="line">  var rnPackage = options.version; // e.g. &apos;0.38&apos; or &apos;/path/to/archive.tgz&apos;</span><br><span class="line"></span><br><span class="line">  console.log(&apos;Installing &apos; + getInstallPackage(rnPackage) + &apos;...&apos;);</span><br><span class="line">   //...代码省略</span><br><span class="line">  installCommand =  &apos;npm install --save --save-exact &apos; + getInstallPackage(rnPackage);</span><br><span class="line">  if (options.verbose) &#123;</span><br><span class="line">      installCommand += &apos; --verbose&apos;;</span><br><span class="line">   &#125;</span><br><span class="line">   //...代码省略</span><br><span class="line">   try &#123;</span><br><span class="line">    execSync(installCommand, &#123;stdio: &apos;inherit&apos;&#125;);</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">      //... 代码省略</span><br><span class="line">  &#125;</span><br><span class="line">  cli.init(root, projectName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其中这个 <code>rnPackage</code> 就是解析的 version 参数 ，所以，对于我的第一次使用的命令：<code>react-native init yx_rnDemo --version0.47.2</code> 来说，解析工具并没有找到 key 为 version 的参数，所以第一次命令的 <code>rnPackage</code>的值应该是空的，输入正确后就是 0.47.2 了。<br>然后看 <code>installCommand</code>  这个变量，就是最终执行的命令。其中一个参数是需要到<code>getInstallPackage(rnPackage)</code>去确定一下是什么。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function getInstallPackage(rnPackage) &#123;</span><br><span class="line">  var packageToInstall = &apos;react-native&apos;;</span><br><span class="line">  var isValidSemver = semver.valid(rnPackage);</span><br><span class="line">  if (isValidSemver) &#123;</span><br><span class="line">    packageToInstall += &apos;@&apos; + isValidSemver;</span><br><span class="line">  &#125; else if (rnPackage) &#123;</span><br><span class="line">    // for tar.gz or alternative paths</span><br><span class="line">    packageToInstall = rnPackage;</span><br><span class="line">  &#125;</span><br><span class="line">  return packageToInstall;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>OMG！ 看到上面的代码 激不激动，终于真相大白了！！<br>按照我的第一次错误的写法，这个 rnPackage 是空，然后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var isValidSemver = semver.valid(rnPackage);</span><br></pre></td></tr></table></figure>
<p>这一行代码的含义是进行一个版本语义化规范的检查，就是你创建的版本号必须符合 <a href="https://juejin.im/post/5ad413ba6fb9a028b5485866" target="_blank" rel="noopener">semver语义化规范</a>，也就是 <strong>x.y.z</strong> 的格式，比如 0.47.2 ，然而我现在传的空，肯定是不符合规范的，果断返回 false ，所以该方法会返回 “react-native”, 默认会安装最新版。<br>而我后来正确的写法，是符合规范的，最终该方法会返回  “<a href="mailto:react-native@0.47.2" target="_blank" rel="noopener">react-native@0.47.2</a>“ ! 然后就会下载指定的版本了。</p>
<p>最后我们这边可以验证下，输出的 log 参数是不是我们在代码中看到的。</p>
<p>上图：<br><img src="https://img-blog.csdnimg.cn/20181103222931312.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzNzAzODc3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181103222943285.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzNzAzODc3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>果然如此~~</p>
<p>然后终于理解了，<a href="https://reactnative.cn/docs/getting-started/" target="_blank" rel="noopener">react-native 中文网</a> 中提示如果创建指定版本，<strong>版本号必须满足两位小数点</strong> 这句话是为什么了。<br><img src="https://img-blog.csdnimg.cn/20181103223149178.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzNzAzODc3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="step3-总结-amp-填坑"><a href="#step3-总结-amp-填坑" class="headerlink" title="step3. 总结 &amp; 填坑"></a>step3. 总结 &amp; 填坑</h4><p>所以说了那么多，如果想在 init 时候指定版本号，非常简单,，就是官网指出的：</p>
<blockquote>
<p>react-native init MyApp –version 0.44.3</p>
</blockquote>
<p>但必须注意检查两点（估计也就我这么粗心的人会犯吧）：</p>
<p><strong>1.<code>--version</code> 一定要加空格，千万不要写成 <code>--version0.44.3</code></strong></p>
<p> <strong>2.版本号一定要两位小数点，必须符合  <a href="https://juejin.im/post/5ad413ba6fb9a028b5485866" target="_blank" rel="noopener">semver语义化规范</a></strong></p>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><blockquote>
<p><a href="https://github.com/facebook/react-native/blob/83c7303a193fd0c998539be641ba2f8423cddd89/react-native-cli/index.js" target="_blank" rel="noopener">https://github.com/facebook/react-native</a><br><a href="http://nodejs.cn/api/child_process.html" target="_blank" rel="noopener">http://nodejs.cn/api/child_process.html</a><br><a href="http://www.runoob.com/nodejs/nodejs-path-module.html" target="_blank" rel="noopener">http://www.runoob.com/nodejs/nodejs-path-module.html</a><br><a href="http://nodejs.cn/api/fs.html#fs_file_system" target="_blank" rel="noopener">http://nodejs.cn/api/fs.html#fs_file_system</a><br><a href="https://www.jianshu.com/p/231b931ab389" target="_blank" rel="noopener">https://www.jianshu.com/p/231b931ab389</a></p>
</blockquote>

          
        
      
    </div>
    
    
    
<div>
  
</div>
<div>
      
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xiaxiayang.github.io/2018/10/24/android --巧用 flexboxLayout 布局/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiaxiayang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/25956745?s=400&u=3b875396982ce81f05ad70778ceee4e3daf8d909&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夏霂熠雨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/24/android --巧用 flexboxLayout 布局/" itemprop="url">android --巧用 flexboxLayout 布局</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-24T23:23:37+08:00">
                2018-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/10/24/android --巧用 flexboxLayout 布局/" class="leancloud_visitors" data-flag-title="android --巧用 flexboxLayout 布局">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>℃</span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>某天在做项目的时候，遇到了个看似简单但又无从下手的小功能，效果类似微信群聊选择联系人界面：<br><img src="https://i.loli.net/2018/10/24/5bd08f661a5a5.gif" alt="1.gif"><br>有没有发现选择人员变动后上面部分的展示是从中间往两边扩散的？最开始的时候我是直接用 RecycleView 展示的，就是一再普通不过的九宫格布局了。在产品的要求下要改成类似微信的这种布局，然后我就开始了 “面向搜索引擎”的编程，搜寻了半天，什么仿微信啊，什么中间布局啊（事实证明就算是“面向搜索引擎”的编程，我还是要学很多，因为，关键字定位的不准确），未果。</p>
<p>然后一想，嘿嘿，没事，轮子没有自己造呗，一看就得自定义布局。遂拿起我的小本本，准备大干一番，用笔写下思路，磨蹭了十几分钟，本子上只有几个立体几何。。。（有个小癖好，写不出来喜欢在本子上画立方体）。</p>
<p>然后想一时半会自定义也掌握不好啊，时间又赶，遂又开始了大规模搜索。在快要放弃的时候看到了这篇文章：<a href="https://segmentfault.com/a/1190000015241938" target="_blank" rel="noopener">Android 弹性布局 FlexboxLayout了解一下</a><br>看到其中这张图的时候，两眼放光，异常激动啊。<br><img src="https://i.loli.net/2018/10/24/5bd08f8cbbb53.jpg" alt="2.jpg"><br>看完是不是感觉希望就在前方? 于是看了下 flexboxLayout 的介绍，完完全全就是前端的 flexbox 布局啊，连属性名称都一样。因为有点 react native 基础，所以事情变得 so easy。最后看到竟然支持 RecycleView，只需改动极少量的代码，简直不能太赞。</p>
<p>嗯，废话那么多，铺垫那么长，下面来介绍一下今天的主角 ： flexboxLayout 。</p>
<p>首先要做的事情当然是在项目中集成了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.google.android:flexbox:1.0.0&apos;</span><br></pre></td></tr></table></figure>
<h3 id="1-什么是-flexboxLayout-布局？"><a href="#1-什么是-flexboxLayout-布局？" class="headerlink" title="1.什么是 flexboxLayout 布局？"></a>1.什么是 flexboxLayout 布局？</h3><p><a href="https://github.com/google/flexbox-layout" target="_blank" rel="noopener">https://github.com/google/flexbox-layout</a> 项目简介中是这样一句话来概括 flexboxLayout 的：</p>
<blockquote>
<p>FlexboxLayout is a library project which brings the similar capabilities of CSS Flexible Box Layout Module to Android.<br>FlexboxLayout 是一个在 Android 上实现  CSS 的 弹性盒状布局 模块的库</p>
</blockquote>
<p>有前端基础的同学估计都知道 CSS 中这个布局，用来为盒状模型提供最大的灵活性。因为 android 中这个库属性和 CSS 中 都一样，并且阮一峰老师写的前端知识真的很通俗易懂，所以这里的介绍大多来自 <a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html" target="_blank" rel="noopener">Flex 布局教程</a>。<br><img src="https://i.loli.net/2018/10/24/5bd08f8c4c492.png" alt="3.png"><br>采用 Flex 布局的元素，称为 Flex 容器（flex container），简称”容器”。它的所有子元素自动成为容器成员，称为 Flex 项目（flex item），简称”项目”。</p>
<p>容器默认存在两根轴：<strong>水平的主轴</strong>（main axis）和<strong>垂直的交叉轴</strong>（cross axis）。这里与 react native 相反，与前端 CSS 保持一致。</p>
<p>主轴的开始位置（与边框的交叉点）叫做main start，结束位置叫做main end；交叉轴的开始位置叫做cross start，结束位置叫做cross end</p>
<p>项目默认沿主轴排列。单个项目占据的主轴空间叫做 main size，占据的交叉轴空间叫做 cross size。</p>
<h3 id="2-容器的属性-（FlexboxLayout-属性介绍）"><a href="#2-容器的属性-（FlexboxLayout-属性介绍）" class="headerlink" title="2.容器的属性 （FlexboxLayout 属性介绍）"></a>2.容器的属性 （FlexboxLayout 属性介绍）</h3><p>这里说的容器也就是上面的采用了 Flex 布局的元素，在 android 中也就是引用了 FlexboxLayout 的 控件。即 FlexboxLayout 控件支持的属性。主要属性有：<br><img src="https://i.loli.net/2018/10/24/5bd08f8d938c3.png" alt="4.png"><br>各个属性的详细含义这里就不再赘述，阮一峰老师 <a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html" target="_blank" rel="noopener">这篇文章</a> 写的超级棒，图文并茂，很容易理解，推荐大家看一下。</p>
<h3 id="3-项目的属性-（子-View-属性介绍）"><a href="#3-项目的属性-（子-View-属性介绍）" class="headerlink" title="3.项目的属性 （子 View 属性介绍）"></a>3.项目的属性 （子 View 属性介绍）</h3><p>设置被 FlexboxLayout 包裹的子 View 的属性，因为 android 中的 flexboxLayout 布局 和 CSS 中 flex 布局关于子 View 属性有些差异，所以这里详细说明下，取值如下：</p>
<ul>
<li>layout_order (integer)</li>
<li>layout_flexGrow (float)</li>
<li>layout_flexGrow (float)</li>
<li>layout_alignSelf</li>
<li>layout_flexBasisPercent (fraction)</li>
<li>layout_minWidth / layout_minHeight (dimension)</li>
<li>layout_maxWidth / layout_maxHeight (dimension)</li>
<li>layout_wrapBefore (boolean)</li>
</ul>
<p>下面来看一下github文档中对这些属性的描述</p>
<h4 id="3-1-layout-order"><a href="#3-1-layout-order" class="headerlink" title="3.1 layout_order"></a>3.1 layout_order</h4><p>这个属性可以改变布局子视图的顺序。默认情况下，子元素的显示和布局顺序与布局XML中的顺序相同。如果没有指定，则将1设置为默认值( CSS 中默认值为 0) ，<strong>数值越小，排列越靠前</strong>。<br><img src="https://i.loli.net/2018/10/24/5bd08f924c38c.gif" alt="5.gif"><br>看下文档中的这张图，可以看到将 “2” 号 View 的  layout_order 属性设置为 -1时，由于其他的 View 默认都是 1，所以 “2” 号 view会排在最前面，同理，将 “2” 号 View 的 layout_order 的属性值设为 2 时，比其他默认值 1 都大，所以会排在最后。</p>
<h4 id="3-2-layout-flexGrow"><a href="#3-2-layout-flexGrow" class="headerlink" title="3.2 layout_flexGrow"></a>3.2 layout_flexGrow</h4><p>这个属性类似于 LinearLayout 中的 <strong>layout_weight</strong> 属性，如果没有指定，则将 0 设置为默认值。如果果同一 flex 行中的多个子 View 有正的 layout_flexGrow 值，那么剩余的空闲空间将根据它们声明的 layout_flexGrow 值的比例分布。</p>
<h3 id="3-3-layout-flexShrink"><a href="#3-3-layout-flexShrink" class="headerlink" title="3.3 layout_flexShrink"></a>3.3 layout_flexShrink</h3><p>该属性定义了子 View 的缩小比例，默认为 1，即如果空间不足，该子 View 将缩小。<br>如果所有子 View 的 layout_flexShrink 属性都为 1，当空间不足时，都将等比例缩小。如果一个项目的 layout_flexShrink 属性为0，其他子View都为 1，则空间不足时，layout_flexShrink 属性为 0 的不缩小。<br><img src="https://i.loli.net/2018/10/24/5bd08f8ec1d4a.gif" alt="6.gif"><br>看一下文档中的这张图，开始设置所有子 view 的 layout_flexShrink 属性为1，添加子 view 的时候所有子 view 等比缩小，但是如果设置 layout_flexShrink 属性值为 0，子 view 将会按照原有比例显示，不缩小。</p>
<h4 id="3-4-layout-alignSelf"><a href="#3-4-layout-alignSelf" class="headerlink" title="3.4  layout_alignSelf"></a>3.4  layout_alignSelf</h4><p>layout_alignSelf 属性允许单个子 View 有与其他 View 不一样的对齐方式，可覆盖 align-items 属性。默认值为 auto，表示继承父元素的 align-items 属性，如果没有父元素，则等同于 stretch。<br>该属性可能取 6 个值，除了 auto，其他都与 align-items 属性完全一致</p>
<h4 id="3-5-layout-flexBasisPercent"><a href="#3-5-layout-flexBasisPercent" class="headerlink" title="3.5  layout_flexBasisPercent"></a>3.5  layout_flexBasisPercent</h4><p>flex-layout_flexBasisPercent 属性定义了在分配多余空间之前，子 View 占据的主轴空间（main size）。根据这个属性来计算主轴是否有多余空间。它的默认值为 -1，即不设置，采用子 View 的本来大小。</p>
<p>如果设置了这个值，layout_width (或 layout_height )中指定的长度将被该属性的计算值覆盖。这个属性只有在父 View 的长度是确定的时候才有效(测量模式是 MeasureSpec.EXACTLY 模式下)。<br>并且该属性值只接受百分比值。<br><img src="https://i.loli.net/2018/10/24/5bd090209b72d.gif" alt="7.gif"><br>可以分析下文档中的这张图：可以看到，如果把中间子 View 的这个属性值设为 50%  或 90%，那么这个 View 将占据主轴 50% 或 90% 的空间，然后剩余 View 会看有没有剩余空间换行。如果设置为 -1 默认值，那么将占据给定的大小。</p>
<h4 id="3-6-layout-minWidth-layout-minHeight"><a href="#3-6-layout-minWidth-layout-minHeight" class="headerlink" title="3.6  layout_minWidth / layout_minHeight"></a>3.6  layout_minWidth / layout_minHeight</h4><p>这个属性设置了子 View 的最小的宽和高。在 layout_flexShrink 模式下，再怎么缩小也不会小于这个值</p>
<h4 id="3-7-layout-maxWidth-layout-maxHeight"><a href="#3-7-layout-maxWidth-layout-maxHeight" class="headerlink" title="3.7 layout_maxWidth / layout_maxHeight"></a>3.7 layout_maxWidth / layout_maxHeight</h4><p>这个属性设置了子 View 的最大的宽和高。在 layout_flexGrow 模式下，再怎么放大也不会大于这个值</p>
<h4 id="3-8-layout-wrapBefore"><a href="#3-8-layout-wrapBefore" class="headerlink" title="3.8 layout_wrapBefore"></a>3.8 layout_wrapBefore</h4><p>这个属性使得子 View 可以强制换行，不管在 main size 剩余空间有多少。这种对于类似 grid 网格布局中特殊设置某一个 item 布局特别有用。<br>这个属性是 CSS 中没有的属性。该属性在 flex_wrap 属性值 为 nowrap（不换行）的时候是无效的。<br>该属性结束 boolean 变量，默认 false，即不强制换行<br><img src="https://i.loli.net/2018/10/24/5bd0901f8e4a8.gif" alt="9.gif"><br>分析下文档中的这张图，“5” 号和 “6” 号 View 设置 layout_wrapBefore 属性为ture 的时候，不管前面剩余多少空间，都会强制换行</p>
<p>到这里，flexboxLayout 基本属性就介绍完毕了。</p>
<p>然后再来介绍一下跟 recycleView 结合使用。</p>
<h4 id="4-高能：与-RecyclewView-结合使用"><a href="#4-高能：与-RecyclewView-结合使用" class="headerlink" title="4.  高能：与 RecyclewView 结合使用"></a>4.  高能：与 RecyclewView 结合使用</h4><p>Flexbox 能够作为一个 LayoutManager(FlexboxlayoutManager) 用在 RecyclerView 里面，这也就意味着你可以在一个有大量 Item 的可滚动容器里面使用 Flexbox，提高性能。具体使用示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//设置主轴方向为横轴</span><br><span class="line">FlexboxLayoutManager manager = new FlexboxLayoutManager(this, FlexDirection.ROW);</span><br><span class="line">//设置item沿主轴方向的位置</span><br><span class="line">manager.setJustifyContent(JustifyContent.CENTER);</span><br><span class="line">//设置item 沿次轴方向的位置</span><br><span class="line">manager.setAlignItems(AlignItems.CENTER);</span><br><span class="line"></span><br><span class="line">recycleView.setLayoutManager(manager);</span><br><span class="line">centerGridAdapter = new CenterGridAdapter(items, this);</span><br><span class="line">recycleView.setAdapter(centerGridAdapter);</span><br></pre></td></tr></table></figure>
<p>可以看到跟 RecycleView 的其他 manager 使用一样，只需设置 manager 属性即可，属性值为上面叙述的几个容器的属性。<br>如果想对某个 item 进行单独的设置，可以在 adapter 中去设置，设置示例代码为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ViewGroup.LayoutParams lp =  holder.itemLL.getLayoutParams();</span><br><span class="line">       if (lp instanceof FlexboxLayoutManager.LayoutParams) &#123;</span><br><span class="line">           FlexboxLayoutManager.LayoutParams flexboxLp =</span><br><span class="line">                   (FlexboxLayoutManager.LayoutParams)  holder.itemLL.getLayoutParams();</span><br><span class="line">           flexboxLp.setFlexGrow(1.0f);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>我这里是设置每个 item 有个权重（相当于 Linearlayout 的 weight 属性），所以会按比例分配 item 的宽，而不是我布局中设定的固定宽高。看下效果：<br><img src="https://i.loli.net/2018/10/24/5bd0901cb94cb.png" alt="10.png"></p>
<p>是不是有种键盘的感觉？并且我只是修改了极少的代码就实现了这个功能。</p>
<h3 id="小试牛刀1"><a href="#小试牛刀1" class="headerlink" title="小试牛刀1"></a>小试牛刀1</h3><p>最后，看了那么多，回到最开始的问题上，现在知道类似微信的那个中间扩展的网格布局怎么写的吗？<br>首先我们简单分析一下，</p>
<ul>
<li>主轴方向我们应该设置为水平方向，即默认 flexDirection ：“row”’</li>
<li>可以换行，即 flexWrap：“wrap”</li>
<li>子 View 在主轴方向的对其方式为居中（这一步实现从中间往两边展开），即 justifyContent: “center”</li>
<li>子 View 在交叉轴方向的对其方式为居中，即 alignItems:”center”</li>
<li>子 View 宽高固定</li>
</ul>
<p>也就是上面讲 Recycleview 结合的例子中去掉单独设置 item 的部分，并且 item 的宽高要根据屏幕来适配的。<br>嗯，就是 so easy。</p>
<h3 id="小试牛刀2"><a href="#小试牛刀2" class="headerlink" title="小试牛刀2"></a>小试牛刀2</h3><p><img src="https://i.loli.net/2018/10/24/5bd0901ef3ed1.png" alt="11.png"><br>实际应用中还有种很常见的就是那种分类选择的布局，像图中的网易和简书中，这种布局用我们今天的这个主角是不是轻而易举的就实现了？都不用设置特别的属性，内容超过一行自动换行。<br>代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//设置主轴方向为横轴</span><br><span class="line">       FlexboxLayoutManager manager = new FlexboxLayoutManager(this, FlexDirection.ROW);</span><br><span class="line">       //设置item沿主轴方向的位置</span><br><span class="line">       manager.setJustifyContent(JustifyContent.FLEX_START);</span><br><span class="line">       //设置item 沿次轴方向的位置</span><br><span class="line">       manager.setAlignItems(AlignItems.CENTER);</span><br><span class="line"></span><br><span class="line">       recycleView.setLayoutManager(manager);</span><br><span class="line">       labelAdapter = new LabelAdapter(labels,this);</span><br><span class="line">       recycleView.setAdapter(labelAdapter);</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>所以说了这么多，那么我们什么时候会用到这种布局呢？我目前想到的场景主要有 3 类：</p>
<ol>
<li>类似LinearLayout 线性布局，但是又可以自动换行的</li>
<li>类似grid 网格布局的，但总有一两个item的排列方式很特立独行的</li>
<li>类似瀑布流的，但也是总有一两个item跟别人不一样的</li>
</ol>
<p>当然这些场景加上 RecycleView 就会更加畅享丝滑了。</p>
<p>demo <a href="https://github.com/xiaxiayang/YX_FlexboxLayout" target="_blank" rel="noopener">传送门</a></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html" target="_blank" rel="noopener">阮一峰：Flex 布局教程：语法篇</a><br><a href="https://github.com/google/flexbox-layout" target="_blank" rel="noopener">flexbox-layout 的 github 地址</a></p>

          
        
      
    </div>
    
    
    
<div>
  
</div>
<div>
      
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xiaxiayang.github.io/2018/09/29/android -- 善用 tools 属性让布局预览更加美好/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiaxiayang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/25956745?s=400&u=3b875396982ce81f05ad70778ceee4e3daf8d909&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夏霂熠雨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/29/android -- 善用 tools 属性让布局预览更加美好/" itemprop="url">android -- 善用 tools 属性让布局预览更加美好</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-29T22:43:46+08:00">
                2018-09-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/09/29/android -- 善用 tools 属性让布局预览更加美好/" class="leancloud_visitors" data-flag-title="android -- 善用 tools 属性让布局预览更加美好">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>℃</span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>事情是这样的，前几周在做项目聊天页面 UI 微信一致化的时候，出现了如下场景：</p>
<blockquote>
<p>QA：为什么个人信息页面刚进来的时候默认值是111？（额，抱歉，布局里写死了）<br> QA:你这个消息未读数位置太靠里了 ！ (哦，赶紧找对应布局，发现默认是 gone 掉的， ok ，调成 visible ，调整位置完事 。)<br>  QA： 你这个消息免打扰的图标太大了，图片颜色太重了，位置再往左边一点 !( 哦， 好的，马上调 )<br>  QA： 群公告页面群名称太长的时候页面显示有问题，字体也太大了，字数卡控一下 ( 哦，好的，就调 )<br>  QA: 你这个 。。。 ( 哦。。。)<br>经历了一番折腾与调整（基本改一两行代码运行跑一次，改 1 分钟，运行 3 分钟），再次提测，没一会，QA： 你怎么又改出问题了？为什么系统消息会显示免打扰图标？ 免打扰的时候消息未读数展示也不对了，群消息页面的字展示还是有问题？( 哦，我查一下代码 )</p>
</blockquote>
<p>最后查了代码发现之前默认隐藏的布局，我为了调样式设置为 visible 后忘了调回去了，然后代码里也没做 gone 的判断。<br>那类似这样的调整布局的方式有没有什么奇淫技巧，让我不改变我之前设定的值还能预览到我改变后的变化的？<br>答案就是 ：利用 <strong>tools</strong> 属性。</p>
<h3 id="认识-tools-属性"><a href="#认识-tools-属性" class="headerlink" title="认识 tools 属性"></a>认识 tools 属性</h3><p>在android studio 3.0 以后，会发现每次创建布局的时候再根<code>&lt;View&gt;</code> 都会自动添上  <code>xmlns:tools=&quot;http://schemas.android.com/tools&quot;</code> 命名空间 和 <code>tools:context</code> 标签。<br>如果我们删除这个属性，好像布局也不会有什么变化，那它到底有什么用呢？首先看一下文档上的解释：</p>
<blockquote>
<p>  tools 命名空间在 Android Studio 中支持各种 XML 属性，这些属性支持设计时特性(如在片段中显示的布局)或编译时行为(如应用于 XML 资源的 shrinking  模式)。在构建应用程序时，构建工具会删除这些属性，因此不会影响 APK 大小或运行时行为。</p>
</blockquote>
<p>总结起来也就是以下两点：</p>
<ul>
<li>tools 属性作用分为两类 : 设计时特性（主要表现在 XML 布局预览） 和 编译时行为</li>
<li>在 build 程序的时候，这些属性不会被编译，对APK 没有影响，也就是放心大胆地用吧</li>
</ul>
<p>所以，我们下面来具体看一下，第一类：设计时特性（XML 布局预览效果）</p>
<h3 id="Design-time-view-attributes-（设计时特性）"><a href="#Design-time-view-attributes-（设计时特性）" class="headerlink" title="Design-time view attributes （设计时特性）"></a>Design-time view attributes （设计时特性）</h3><p>首先需要注意的是这些属性只在 android studio 的布局预览页面有效</p>
<h4 id="1-tools-instead-of-android"><a href="#1-tools-instead-of-android" class="headerlink" title="1. tools: (instead of android)"></a>1. <code>tools:</code> (instead of android)</h4><p>用 tools 命名空间可以替代所有以 android 命名空间开头的属性。比如<code>tools:visibility</code> 。<br>使用对象：任何<code>&lt;View&gt;</code><br>使用场景：比如预览某个 View 显示与隐藏，TextView 字体大小，多行显示，给某个 View 设置背景色等等，可以替代任何一个 android 命名空间的属性值<br><img src="https://i.loli.net/2018/09/29/5baf922fe5c2a.png" alt="tool1.png"></p>
<h4 id="2-tools-context"><a href="#2-tools-context" class="headerlink" title="2.tools:context"></a>2.<code>tools:context</code></h4><p>这个属性声明了该布局关联的 Activity。使编辑器或布局预览中需要了解 Activity 的特性成为可能。<br>使用对象：任何根<code>&lt;View&gt;</code><br>使用场景：（1）设置预览主题为关联 Activity 的主题  （2）View 的 onclick 方法快速自动插入到关联 Activity 中</p>
<p><img src="https://i.loli.net/2018/09/29/5baf9251d2240.png" alt="tools2.png"><br><img src="https://i.loli.net/2018/09/29/5baf9266bf411.png" alt="tools3.png"><br>对于在布局中写 onClick 的是不是爽到爆？</p>
<h3 id="3-tools-layout"><a href="#3-tools-layout" class="headerlink" title="3. tools:layout"></a>3. <code>tools:layout</code></h3><p>这个属性是展示  fragment  对应的布局。<br>使用对象：<code>&lt;fragment&gt;</code><br>使用场景：在 XML 中直接引用<code>fragment</code> 标签的。<br>如果我们不引用这个属性，布局预览中会这样显示：<br><img src="https://i.loli.net/2018/09/29/5baf927cca406.png" alt="tools4.png"><br>是看不到对应的 fragment 的布局的，当我们引用了<code>tools：layout</code>属性后，就可以预览 fragment 对应的布局<br><img src="https://i.loli.net/2018/09/29/5baf928eccfce.png" alt="tools5.png"></p>
<h4 id="4-tools-listitem-tools-listheader-tools-listfooter"><a href="#4-tools-listitem-tools-listheader-tools-listfooter" class="headerlink" title="4.tools:listitem / tools:listheader / tools:listfooter"></a>4.<code>tools:listitem / tools:listheader / tools:listfooter</code></h4><p>这一组特性专为<code>&lt;AdapterView&gt;</code>比如 ListView 和 RecycleView 打造。见名知意，其中：</p>
<ul>
<li><code>tools:listitem</code>是设置 item 布局的预览</li>
<li><code>tools：listheader</code>设置添加 ListView/RecycleView 的头布局预览</li>
<li><code>tools:listfooter</code>设置添加ListView/RecycleView 的 footer 布局预览</li>
</ul>
<p>实际操作中发现在 RecycleView 中 header 和 footer 显示不出来<br><img src="https://i.loli.net/2018/09/29/5baf92a821abc.png" alt="tools10.png"></p>
<p><strong>注意事项：Listview/RecycleView 一定要声明 id 才会有效，footer 效果一般显示不出来</strong></p>
<h4 id="5-tools-itemCount"><a href="#5-tools-itemCount" class="headerlink" title="5.tools:itemCount"></a>5.<code>tools:itemCount</code></h4><p>这个属性指定 Recycleview 显示多少行<br>使用对象：<code>&lt;RecycleView&gt;</code><br>使用场景：比如我们布局中 RecycleView 下面还有内容或者想看只有一条数据的时候的效果，都可以指定可预览的行数，比如上面的 RecycleView 指定只显示三行，显示如下图：<br><img src="https://i.loli.net/2018/09/29/5baf92bbe19a1.png" alt="tools11.png"></p>
<h4 id="5-tools：showin"><a href="#5-tools：showin" class="headerlink" title="5. tools：showin"></a>5. <code>tools：showin</code></h4><p>这个属性作用在由 <code>include</code> 标签引用的根 <code>&lt;View&gt;</code> 上，可以预览当前 <code>include</code> 布局在其引用的父类  View 布局中的效果，方便预览和编辑当前布局。<br>使用对象：任何 <code>include</code> 标签指向的布局的 根 <code>View</code><br>使用场景：比如我有一个布局 activity_include, 里面布局如下：</p>
<p><img src="https://i.loli.net/2018/09/29/5baf92d318983.png" alt="tools6.png"></p>
<p>假设我的 <code>include</code> 里面的布局很复杂，然后我现在要去修改 <code>include</code> 里面的布局，点进入，先预览一下之前的页面：<br><img src="https://i.loli.net/2018/09/29/5baf92e7dcfd1.png" alt="tools7.png"><br>然后，我经过了一番大的改动，想看看这个布局在引用的父布局 activity_include 中的效果，但是呢我又不想再切换到 activity_include 布局中去检查，万一改的不对，岂不是还要再切换回来，于是我加上<code>tools:showIn=&quot;@layout/activity_include&quot;</code> ，然后在当前预览页面就可以看到完整的页面了：<br><img src="https://i.loli.net/2018/09/29/5baf92f95dff2.png" alt="tools8.png"></p>
<p>是不是很方便？<br>除了这几个属性，还有<code>tools:menu</code>、<code>tools:minValue / tools:maxValue</code>、<code>tools:openDrawer</code>、<code>&quot;@tools:sample/*&quot; resources</code> 这几个，由于不(wo)常(bi)用(jiao)到（lan）,这里就不一一介绍了，大家可以查阅<a href="https://developer.android.com/studio/write/tool-attributes" target="_blank" rel="noopener">文档</a></p>
<p>最开始的时候我们说过，tools 属性主要包含两类，一类设计时特性，用于页面预览，另一类就是编译时行为了</p>
<h3 id="Error-handling-attributes（编译时属性）"><a href="#Error-handling-attributes（编译时属性）" class="headerlink" title="Error handling attributes（编译时属性）"></a>Error handling attributes（编译时属性）</h3><p>这类属性主要是有助于抑制 Lint 警告消息。</p>
<h3 id="1-tools-ignore"><a href="#1-tools-ignore" class="headerlink" title="1.tools:ignore"></a>1.<code>tools:ignore</code></h3><p>主要用于设置 Lint  忽略一些信息。 比如，我们 string 字符串有些进行了多语言的翻译，但是有些由于时间匆忙，来不及翻译，运行的时候编译器又会报警告，这个时候我们就可以用 tools:ignore 来让 Lint  忽略这些</p>
<h3 id="2-tools-targetApi"><a href="#2-tools-targetApi" class="headerlink" title="2.tools:targetApi"></a>2.<code>tools:targetApi</code></h3><p>这个跟上面的一样，同样是让 Lint 忽略一些信息的，比如有些控件只在 targetApi = 11 的时候生效，那我们现在的 targetApi  = 25，就会报 minSdkVersion 的警告，那么我们就通过 tools:targetApi 设置目标 api</p>
<h3 id="3-tools-locale"><a href="#3-tools-locale" class="headerlink" title="3.tools:locale"></a>3.<code>tools:locale</code></h3><p>这个属性是用来告诉编译工具在给定资源的元素中默认的语言/区域设置是什么(因为工具默认采用英语)，以避免拼写检查器发出警告。该值必须是有效的地区限定符。<br>使用对象：<code>&lt;resources&gt;</code><br>例如，我们可以将其添加到我们的字符串中告诉编译器我们默认使用中文而不是英语<br><img src="https://i.loli.net/2018/09/29/5baf931258c41.png" alt="tools9.png"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>大致就这么多，主要应用在布局预览中。<br>tools 属性一般会被忽略，但是在调试布局的时候真的是把利器。所以善用它，我们可以更高效的预览和修改布局，有句话说的好，所见即所得。<br>最后附上一张表格：</p>
<table>
<thead>
<tr>
<th><strong>属性</strong></th>
<th><strong>作用对象</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>tools: （替代android：）</strong></td>
<td><strong><code>&lt;View&gt;对象</code></strong></td>
<td><strong>可替代所有以android：开头的属性</strong></td>
</tr>
<tr>
<td><strong>tools:context</strong></td>
<td><strong>根</strong><code>&lt;View&gt;</code></td>
<td><strong>声明了该布局关联的Activity</strong></td>
</tr>
<tr>
<td><strong>tools:layout</strong></td>
<td><strong><code>&lt;fragment&gt;</code></strong></td>
<td><strong>展示 fragment 对应的布局</strong></td>
</tr>
<tr>
<td><strong>tools:listitem</strong></td>
<td><strong><code>&lt;List&gt;/&lt;RecycleView&gt;</code></strong></td>
<td><strong>展示 ListView/RecycleView 的item布局</strong></td>
</tr>
<tr>
<td><strong>tools:listheader</strong></td>
<td><strong><code>&lt;List&gt;/&lt;RecycleView&gt;</code></strong></td>
<td><strong>展示 ListView/RecycleView 的header布局</strong></td>
</tr>
<tr>
<td><strong>tools:listfooter</strong></td>
<td><strong><code>&lt;List&gt;/&lt;RecycleView&gt;</code></strong></td>
<td><strong>展示 ListView/RecycleView 的footer布局</strong></td>
</tr>
<tr>
<td><strong>tools:listfooter</strong></td>
<td><strong><code>&lt;List&gt;/&lt;RecycleView&gt;</code></strong></td>
<td><strong>展示 ListView/RecycleView 的footer布局</strong></td>
</tr>
<tr>
<td><strong>tools:itemCount</strong></td>
<td><strong><code>&lt;RecycleView&gt;</code></strong></td>
<td><strong>指定 RecycleView 展示多少行</strong></td>
</tr>
<tr>
<td><strong>tools：showin</strong></td>
<td><strong><code>&lt;include&gt;</code>所指向布局的</strong>根<strong><code>&lt;View&gt;</code></strong></td>
<td><strong>预览当前include布局在其引用的父类View布局中的效果，方便预览和编辑当前布局</strong></td>
</tr>
<tr>
<td><strong>tools:ignore</strong></td>
<td><strong>Lint</strong></td>
<td><strong>让编译器忽略警告</strong></td>
</tr>
<tr>
<td><strong>tools:targetAp</strong>i</td>
<td><strong>Lint</strong></td>
<td><strong>指定targetApi，让编译器忽略targetApi问题警告</strong></td>
</tr>
<tr>
<td><strong>tools:locale</strong></td>
<td><strong>Lint, Android Studio editor</strong></td>
<td><strong>设置给定资源的元素中默认的语言，以避免拼写检查器发出警告</strong></td>
</tr>
</tbody>
</table>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><blockquote>
<p><a href="https://developer.android.com/studio/write/tool-attributes#error_handling_attributes" target="_blank" rel="noopener">https://developer.android.com/studio/write/tool-attributes#error_handling_attributes</a></p>
</blockquote>

          
        
      
    </div>
    
    
    
<div>
  
</div>
<div>
      
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xiaxiayang.github.io/2018/09/25/android studio --常用插件整理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiaxiayang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/25956745?s=400&u=3b875396982ce81f05ad70778ceee4e3daf8d909&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夏霂熠雨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/25/android studio --常用插件整理/" itemprop="url">android studio 常用插件整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-25T23:19:37+08:00">
                2018-09-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/插件/" itemprop="url" rel="index">
                    <span itemprop="name">插件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/09/25/android studio --常用插件整理/" class="leancloud_visitors" data-flag-title="android studio 常用插件整理">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>℃</span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>今天在写代码找有道词典翻译的时候突然想到之前在公众号看到过一篇推送，说的是一个翻译插件，支持 terminal 中直接查询，当时感觉很方便，然后就忘了安装了。所以今天又是翻郭神的公众号又是翻 hongyang 的公众号，找了好一会记录才找到。所以感觉有必要记一下目前在用的几个比较赞的 android studio  插件，以后换电脑什么的也比较好重新设置。</p>
<p>下面用的插件都是直接在 android studio 中的 plugins 中直接搜就可以 get 到。</p>
<h3 id="1-GsonFormat"><a href="#1-GsonFormat" class="headerlink" title="1.GsonFormat"></a>1.GsonFormat</h3><p>一键生成 java bean。<br>这个估计现在大家人手一份（哈哈），因为实在是很方便，从此解放双手，不用一个个去定义字段然后实现 getter and setter 方法了。<br><img src="https://camo.githubusercontent.com/0d45c79c54ab57f6efe31e9019b11d93974fa039/687474703a2f2f75706c6f61642d696d616765732e6a69616e7368752e696f2f75706c6f61645f696d616765732f3136363836362d666639646333333661663732643764372e6769663f696d6167654d6f6772322f6175746f2d6f7269656e742f7374726970" alt="图片来源下方链接博客"><br>链接 ：<a href="https://github.com/zzz40500/GsonFormat" target="_blank" rel="noopener">https://github.com/zzz40500/GsonFormat</a></p>
<h3 id="2-Alibaba-Java-Coding-Guidelines"><a href="#2-Alibaba-Java-Coding-Guidelines" class="headerlink" title="2. Alibaba Java Coding Guidelines"></a>2. Alibaba Java Coding Guidelines</h3><p>alibaba 代码规范插件，使用这个插件后，明显对变量命名规范了很多，特别是多人开发项目比较急，之前变量名称都是自己想怎么写怎么写，含义对不对暂且不说，单个单词拼写都是错的，所以经常见到什么 cancle 、 aplicaton 之类错误的单词，有了这个插件，只要拼写不对，就提示，不改根本不能忍好吗。<br>并且还包括注释、方法比如 switch case 语句要有 defalut 等。我认为目前在团队中效果实现挺好，至少代码看起来整洁了很多。<br><img src="https://i.loli.net/2018/09/25/5baa5319b312e.png" alt=""></p>
<p><img src="https://i.loli.net/2018/09/25/5baa533eefae8.png" alt=""></p>
<p>链接：<a href="https://mp.weixin.qq.com/s/IbibsXlWHlM59kfXJqRvZA#rd" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/IbibsXlWHlM59kfXJqRvZA#rd</a></p>
<h3 id="3-AndroidSourceView"><a href="#3-AndroidSourceView" class="headerlink" title="3. AndroidSourceView"></a>3. AndroidSourceView</h3><p>这个插件真的是非常赞，对于之前一直懒得甚至不知道怎么下载源码的我来说，真的是很棒的一个插件。对于想看源码或者想看官方文档的，都可以一键直达，并且还有各个 sdk 版本源码差分对比。<br><img src="https://github.com/pengwei1024/AndroidSourceViewer/raw/master/screenshot/ss5.gif" alt="图片来源下方链接"><br>链接 ：<a href="https://github.com/pengwei1024/AndroidSourceViewer" target="_blank" rel="noopener">https://github.com/pengwei1024/AndroidSourceViewer</a></p>
<h3 id="4-Translation"><a href="#4-Translation" class="headerlink" title="4. Translation"></a>4. Translation</h3><p>一个翻译插件，就是文章开头在找的一个。安装后，再也不用担心在 android studio 和 有道翻译间来回跳了。<br>并且直接在 teminal 中输命令是多么帅气的事情（就是稍微有那么一丢丢慢，但是丝毫不影响心情啊~~）<br><img src="https://raw.githubusercontent.com/kenshinji/yddict/master/example.gif" alt="图片来源下方链接"><br>链接 ：<a href="https://github.com/kenshinji/yddict" target="_blank" rel="noopener">https://github.com/kenshinji/yddict</a></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>目前在用的就是这几个，我认为都是平常很有用的。如果你还没用到，赶紧试试吧，说不定就有一款适合你。当然，如果你有什么好的神兵利器，欢迎推荐~~。</p>

          
        
      
    </div>
    
    
    
<div>
  
</div>
<div>
      
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://avatars0.githubusercontent.com/u/25956745?s=400&u=3b875396982ce81f05ad70778ceee4e3daf8d909&v=4"
                alt="xiaxiayang" />
            
              <p class="site-author-name" itemprop="name">xiaxiayang</p>
              <p class="site-description motion-element" itemprop="description">万事起于乎微</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xiaxiayang</span>

  
</div>


<!--

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>



-->
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("ByyCi7vrXdGjsa6CpXHlJEvk-gzGzoHsz", "g9aOj0XwnjgbqfEbmmyuBw2O");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
